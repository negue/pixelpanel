var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function r(e){e.forEach(t)}function o(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function i(e,t){e.appendChild(t)}function a(e,t,n){e.insertBefore(t,n||null)}function c(e){e.parentNode.removeChild(e)}function l(e){return document.createElement(e)}function u(e){return document.createTextNode(e)}function h(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function f(e,t,n,r){e.style.setProperty(t,n,r?"important":"")}let d;function m(e){d=e}const p=[],g=[],v=[],_=[],b=Promise.resolve();let y=!1;function w(e){v.push(e)}let S=!1;const C=new Set;function k(){if(!S){S=!0;do{for(let e=0;e<p.length;e+=1){const t=p[e];m(t),x(t.$$)}for(p.length=0;g.length;)g.pop()();for(let e=0;e<v.length;e+=1){const t=v[e];C.has(t)||(C.add(t),t())}v.length=0}while(p.length);for(;_.length;)_.pop()();y=!1,S=!1,C.clear()}}function x(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(w)}}const I=new Set;function E(e,t){-1===e.$$.dirty[0]&&(p.push(e),y||(y=!0,b.then(k)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function N(s,i,a,l,u,h,f=[-1]){const p=d;m(s);const g=i.props||{},v=s.$$={fragment:null,ctx:null,props:h,update:e,not_equal:u,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(p?p.$$.context:[]),callbacks:n(),dirty:f};let _=!1;if(v.ctx=a?a(s,g,(e,t,...n)=>{const r=n.length?n[0]:t;return v.ctx&&u(v.ctx[e],v.ctx[e]=r)&&(v.bound[e]&&v.bound[e](r),_&&E(s,e)),t}):[],v.update(),_=!0,r(v.before_update),v.fragment=!!l&&l(v.ctx),i.target){if(i.hydrate){const e=function(e){return Array.from(e.childNodes)}(i.target);v.fragment&&v.fragment.l(e),e.forEach(c)}else v.fragment&&v.fragment.c();i.intro&&((b=s.$$.fragment)&&b.i&&(I.delete(b),b.i(y))),function(e,n,s){const{fragment:i,on_mount:a,on_destroy:c,after_update:l}=e.$$;i&&i.m(n,s),w(()=>{const n=a.map(t).filter(o);c?c.push(...n):r(n),e.$$.on_mount=[]}),l.forEach(w)}(s,i.target,i.anchor),k()}var b,y;m(p)}function T(e,t,n){return Array.from(function*(e,t,n){if(n=n||1,void 0===t&&(t=e>0?e:0,e=e<0?e:0),e!=t){e>t&&(n*=-1);for(let r=e;r<t;r+=n)yield r}}(e,t,n))}class O{constructor(){this._options={};var e=location.search.substr(1).split("&"),t={};e.forEach(e=>{const[n,r]=e.split("=");t[n]=r}),console.info({options:t}),this._options=Object.assign({direction:"column",cellSize:"40px",cellGap:"5px",cells:420,channel:"",shadow:!1,delay:300,ignoreUsers:""},t)}getDirection(){return this._options.direction}getCellSize(){return this._options.cellSize}getCellGap(){return this._options.cellGap}getCells(){return+this._options.cells}getChannel(){return this._options.channel}getShadow(){return this._options.shadow}getAnimationDelay(){return this._options.delay}getIgnoredUsers(){return this._options.ignoreUsers}}const D=[];function P(t,n=e){let r;const o=[];function i(e){if(s(t,e)&&(t=e,r)){const e=!D.length;for(let e=0;e<o.length;e+=1){const n=o[e];n[1](),D.push(n,t)}if(e){for(let e=0;e<D.length;e+=2)D[e][0](D[e+1]);D.length=0}}}return{set:i,update:function(e){i(e(t))},subscribe:function(s,a=e){const c=[s,a];return o.push(c),1===o.length&&(r=n(i)||e),s(t),()=>{const e=o.indexOf(c);-1!==e&&o.splice(e,1),0===o.length&&(r(),r=null)}}}}var L="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function R(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return $(null==t&&n.path)}},n.exports),n.exports}function $(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var j,A=Object.freeze({__proto__:null,default:{}}),M=R((function(e){var t=/^\u0001ACTION ([^\u0001]+)\u0001$/,n=/^(justinfan)(\d+$)/,r=/\\([sn:r\\])/g,o={s:" ",n:"",":":";",r:""},s=e.exports={get:(e,t)=>void 0===e?t:e,isBoolean:e=>"boolean"==typeof e,isFinite:e=>isFinite(e)&&!isNaN(parseFloat(e)),isInteger:e=>!isNaN(s.toNumber(e,0)),isJustinfan:e=>n.test(e),isNull:e=>null===e,isRegex:e=>/[\|\\\^\$\*\+\?\:\#]/.test(e),isString:e=>"string"==typeof e,isURL:e=>RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i").test(e),justinfan:()=>"justinfan"+Math.floor(8e4*Math.random()+1e3),password:e=>["SCHMOOPIIE","",null].includes(e)?"SCHMOOPIIE":"oauth:"+e.toLowerCase().replace("oauth:",""),promiseDelay:e=>new Promise((function(t){setTimeout(t,e)})),replaceAll:(e,t)=>{if(null==e)return null;for(var n in t)e=e.replace(new RegExp(n,"g"),t[n]);return e},unescapeHtml:e=>e.replace(/\\&amp\\;/g,"&").replace(/\\&lt\\;/g,"<").replace(/\\&gt\\;/g,">").replace(/\\&quot\\;/g,'"').replace(/\\&#039\\;/g,"'"),unescapeIRC:e=>e&&e.includes("\\")?e.replace(r,(e,t)=>t in o?o[t]:t):e,actionMessage:e=>e.match(t),addWord:(e,t)=>e.length?e+" "+t:e+t,channel:e=>{var t=(e||"").toLowerCase();return"#"===t[0]?t:"#"+t},extractNumber:e=>{for(var t=e.split(" "),n=0;n<t.length;n++)if(s.isInteger(t[n]))return~~t[n];return 0},formatDate:e=>{var t=e.getHours(),n=e.getMinutes();return`${t=(t<10?"0":"")+t}:${n=(n<10?"0":"")+n}`},inherits:(e,t)=>{e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},isNode:()=>{try{return"object"==typeof process&&"[object process]"===Object.prototype.toString.call(process)}catch(e){}return!1},isExtension:()=>{try{return window.chrome&&chrome.runtime&&chrome.runtime.id}catch(e){}return!1},isReactNative:()=>{try{return navigator&&"ReactNative"==navigator.product}catch(e){}return!1},merge:Object.assign,splitLine:(e,t)=>{var n=e.substring(0,t).lastIndexOf(" ");return-1===n&&(n=t-1),[e.substring(0,n),e.substring(n+1)]},toNumber:(e,t)=>{if(null===e)return 0;var n=Math.pow(10,s.isFinite(t)?t:0);return Math.round(e*n)/n},union:(e,t)=>{for(var n={},r=[],o=0;o<e.length;o++){n[s=e[o]]||(n[s]=!0,r.push(s))}for(o=0;o<t.length;o++){var s;n[s=t[o]]||(n[s]=!0,r.push(s))}return r},username:e=>{var t=(e||"").toLowerCase();return"#"===t[0]?t.slice(1):t}}})),B=(j=A)&&j.default||j,U=function(e,t){var n=null===M.get(e.url,null)?M.get(e.uri,null):M.get(e.url,null);if(M.isURL(n)||(n="https://api.twitch.tv/kraken"+("/"===n[0]?n:"/"+n)),M.isNode())B(M.merge({method:"GET",json:!0},e,{url:n}),t);else if(M.isExtension()||M.isReactNative()){e=M.merge({url:n,method:"GET",headers:{}},e);var r=new XMLHttpRequest;for(var o in r.open(e.method,e.url,!0),e.headers)r.setRequestHeader(o,e.headers[o]);r.responseType="json",r.addEventListener("load",e=>{4==r.readyState&&(200!=r.status?t(r.status,null,null):t(null,null,r.response))}),r.send()}else{var s="jsonp_callback_"+Math.round(1e5*Math.random());window[s]=function(e){delete window[s],document.body.removeChild(i),t(null,null,e)};var i=document.createElement("script");i.src=`${n}${n.includes("?")?"&":"?"}callback=${s}`,document.body.appendChild(i)}};function G(e,t){return e=M.channel(e),t=M.get(t,30),this._sendCommand(this._getPromiseDelay(),e,"/followers "+t,(n,r)=>{this.once("_promiseFollowers",o=>{o?r(o):n([e,~~t])})})}function z(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/followersoff",(t,n)=>{this.once("_promiseFollowersoff",r=>{r?n(r):t([e])})})}function F(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),null,"PART "+e,(t,n)=>{this.once("_promisePart",r=>{r?n(r):t([e])})})}function H(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/r9kbeta",(t,n)=>{this.once("_promiseR9kbeta",r=>{r?n(r):t([e])})})}function q(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/r9kbetaoff",(t,n)=>{this.once("_promiseR9kbetaoff",r=>{r?n(r):t([e])})})}function W(e,t){return e=M.channel(e),t=M.get(t,300),this._sendCommand(this._getPromiseDelay(),e,"/slow "+t,(n,r)=>{this.once("_promiseSlow",o=>{o?r(o):n([e,~~t])})})}function J(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/slowoff",(t,n)=>{this.once("_promiseSlowoff",r=>{r?n(r):t([e])})})}var V={action:function(e,t){return e=M.channel(e),t=`ACTION ${t}`,this._sendMessage(this._getPromiseDelay(),e,t,(n,r)=>{n([e,t])})},ban:function(e,t,n){return e=M.channel(e),t=M.username(t),n=M.get(n,""),this._sendCommand(this._getPromiseDelay(),e,`/ban ${t} ${n}`,(r,o)=>{this.once("_promiseBan",s=>{s?o(s):r([e,t,n])})})},clear:function(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/clear",(t,n)=>{this.once("_promiseClear",r=>{r?n(r):t([e])})})},color:function(e,t){return t=M.get(t,e),this._sendCommand(this._getPromiseDelay(),"#tmijs","/color "+t,(e,n)=>{this.once("_promiseColor",r=>{r?n(r):e([t])})})},commercial:function(e,t){return e=M.channel(e),t=M.get(t,30),this._sendCommand(this._getPromiseDelay(),e,"/commercial "+t,(n,r)=>{this.once("_promiseCommercial",o=>{o?r(o):n([e,~~t])})})},deletemessage:function(e,t){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/delete "+t,(t,n)=>{this.once("_promiseDeletemessage",r=>{r?n(r):t([e])})})},emoteonly:function(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/emoteonly",(t,n)=>{this.once("_promiseEmoteonly",r=>{r?n(r):t([e])})})},emoteonlyoff:function(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/emoteonlyoff",(t,n)=>{this.once("_promiseEmoteonlyoff",r=>{r?n(r):t([e])})})},followersonly:G,followersmode:G,followersonlyoff:z,followersmodeoff:z,host:function(e,t){return e=M.channel(e),t=M.username(t),this._sendCommand(2e3,e,"/host "+t,(n,r)=>{this.once("_promiseHost",(o,s)=>{o?r(o):n([e,t,~~s])})})},join:function(e){return e=M.channel(e),this._sendCommand(null,null,"JOIN "+e,(t,n)=>{var r=!1,o=(s,i)=>{e===M.channel(i)&&(this.removeListener("_promiseJoin",o),r=!0,s?n(s):t([e]))};this.on("_promiseJoin",o);var s=this._getPromiseDelay();M.promiseDelay(s).then(()=>{r||this.emit("_promiseJoin","No response from Twitch.",e)})})},mod:function(e,t){return e=M.channel(e),t=M.username(t),this._sendCommand(this._getPromiseDelay(),e,"/mod "+t,(n,r)=>{this.once("_promiseMod",o=>{o?r(o):n([e,t])})})},mods:function(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/mods",(t,n)=>{this.once("_promiseMods",(r,o)=>{r?n(r):(o.forEach(t=>{this.moderators[e]||(this.moderators[e]=[]),this.moderators[e].includes(t)||this.moderators[e].push(t)}),t(o))})})},part:F,leave:F,ping:function(){return this._sendCommand(this._getPromiseDelay(),null,"PING",(e,t)=>{this.latency=new Date,this.pingTimeout=setTimeout(()=>{null!==this.ws&&(this.wasCloseCalled=!1,this.log.error("Ping timeout."),this.ws.close(),clearInterval(this.pingLoop),clearTimeout(this.pingTimeout))},M.get(this.opts.connection.timeout,9999)),this.once("_promisePing",t=>{e([parseFloat(t)])})})},r9kbeta:H,r9kmode:H,r9kbetaoff:q,r9kmodeoff:q,raw:function(e){return this._sendCommand(this._getPromiseDelay(),null,e,(t,n)=>{t([e])})},say:function(e,t){return e=M.channel(e),t.startsWith(".")&&!t.startsWith("..")||t.startsWith("/")||t.startsWith("\\")?"me "===t.substr(1,3)?this.action(e,t.substr(4)):this._sendCommand(this._getPromiseDelay(),e,t,(n,r)=>{n([e,t])}):this._sendMessage(this._getPromiseDelay(),e,t,(n,r)=>{n([e,t])})},slow:W,slowmode:W,slowoff:J,slowmodeoff:J,subscribers:function(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/subscribers",(t,n)=>{this.once("_promiseSubscribers",r=>{r?n(r):t([e])})})},subscribersoff:function(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/subscribersoff",(t,n)=>{this.once("_promiseSubscribersoff",r=>{r?n(r):t([e])})})},timeout:function(e,t,n,r){return e=M.channel(e),t=M.username(t),M.isNull(n)||M.isInteger(n)||(r=n,n=300),n=M.get(n,300),r=M.get(r,""),this._sendCommand(this._getPromiseDelay(),e,`/timeout ${t} ${n} ${r}`,(o,s)=>{this.once("_promiseTimeout",i=>{i?s(i):o([e,t,~~n,r])})})},unban:function(e,t){return e=M.channel(e),t=M.username(t),this._sendCommand(this._getPromiseDelay(),e,"/unban "+t,(n,r)=>{this.once("_promiseUnban",o=>{o?r(o):n([e,t])})})},unhost:function(e){return e=M.channel(e),this._sendCommand(2e3,e,"/unhost",(t,n)=>{this.once("_promiseUnhost",r=>{r?n(r):t([e])})})},unmod:function(e,t){return e=M.channel(e),t=M.username(t),this._sendCommand(this._getPromiseDelay(),e,"/unmod "+t,(n,r)=>{this.once("_promiseUnmod",o=>{o?r(o):n([e,t])})})},unvip:function(e,t){return e=M.channel(e),t=M.username(t),this._sendCommand(this._getPromiseDelay(),e,"/unvip "+t,(n,r)=>{this.once("_promiseUnvip",o=>{o?r(o):n([e,t])})})},vip:function(e,t){return e=M.channel(e),t=M.username(t),this._sendCommand(this._getPromiseDelay(),e,"/vip "+t,(n,r)=>{this.once("_promiseVip",o=>{o?r(o):n([e,t])})})},vips:function(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/vips",(e,t)=>{this.once("_promiseVips",(n,r)=>{n?t(n):e(r)})})},whisper:function(e,t){return(e=M.username(e))===this.getUsername()?Promise.reject("Cannot send a whisper to the same account."):this._sendCommand(this._getPromiseDelay(),"#tmijs",`/w ${e} ${t}`,(n,r)=>{var o=M.channel(e),s=M.merge({"message-type":"whisper","message-id":null,"thread-id":null,username:this.getUsername()},this.globaluserstate);this.emits(["whisper","message"],[[o,s,t,!0],[o,s,t,!0]]),n([e,t])})}};function K(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t});var Y=K;function Q(e){return"function"==typeof e}function X(e){return"object"==typeof e&&null!==e}function Z(e){return void 0===e}K.EventEmitter=K,K.prototype._events=void 0,K.prototype._maxListeners=void 0,K.defaultMaxListeners=10,K.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},K.prototype.emits=function(e,t){for(var n=0;n<e.length;n++){var r=n<t.length?t[n]:t[t.length-1];this.emit.apply(this,[e[n]].concat(r))}},K.prototype.emit=function(e){var t,n,r,o,s,i;if(this._events||(this._events={}),"error"===e&&(!this._events.error||X(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(Z(n=this._events[e]))return!1;if(Q(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),n.apply(this,o)}else if(X(n))for(o=Array.prototype.slice.call(arguments,1),r=(i=n.slice()).length,s=0;s<r;s++)i[s].apply(this,o);return!0},K.prototype.addListener=function(e,t){var n;if(!Q(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,Q(t.listener)?t.listener:t),this._events[e]?X(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,X(this._events[e])&&!this._events[e].warned&&(n=Z(this._maxListeners)?K.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},K.prototype.on=K.prototype.addListener,K.prototype.once=function(e,t){if(!Q(t))throw TypeError("listener must be a function");var n=!1;if(this._events.hasOwnProperty(e)&&"_"===e.charAt(0)){var r=1,o=e;for(var s in this._events)this._events.hasOwnProperty(s)&&s.startsWith(o)&&r++;e+=r}function i(){"_"!==e.charAt(0)||isNaN(e.substr(e.length-1))||(e=e.substring(0,e.length-1)),this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},K.prototype.removeListener=function(e,t){var n,r,o,s;if(!Q(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(n=this._events[e]).length,r=-1,n===t||Q(n.listener)&&n.listener===t){if(delete this._events[e],this._events.hasOwnProperty(e+"2")&&"_"===e.charAt(0)){var i=e;for(var a in this._events)this._events.hasOwnProperty(a)&&a.startsWith(i)&&(isNaN(parseInt(a.substr(a.length-1)))||(this._events[e+parseInt(a.substr(a.length-1)-1)]=this._events[a],delete this._events[a]));this._events[e]=this._events[e+"1"],delete this._events[e+"1"]}this._events.removeListener&&this.emit("removeListener",e,t)}else if(X(n)){for(s=o;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){r=s;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},K.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(Q(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},K.prototype.listeners=function(e){return this._events&&this._events[e]?Q(this._events[e])?[this._events[e]]:this._events[e].slice():[]},K.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(Q(t))return 1;if(t)return t.length}return 0},K.listenerCount=function(e,t){return e.listenerCount(t)};var ee="info",te={trace:0,debug:1,info:2,warn:3,error:4,fatal:5};function ne(e){return function(t){te[e]>=te[ee]&&console.log(`[${M.formatDate(new Date)}] ${e}: ${t}`)}}var re={setLevel:function(e){ee=e},trace:ne("trace"),debug:ne("debug"),info:ne("info"),warn:ne("warn"),error:ne("error"),fatal:ne("fatal")},oe=/\S+/g;function se(e,t,n=",",r="/",o){var s=e[t];if(void 0===s)return e;var i=M.isString(s);if(e[t+"-raw"]=i?s:null,!0===s)return e[t]=null,e;if(e[t]={},i)for(var a=s.split(n),c=0;c<a.length;c++){var l=a[c].split(r),u=l[1];void 0!==o&&u&&(u=u.split(o)),e[t][l[0]]=u||null}return e}var ie=function(e){return se(e,"badges")},ae=function(e){return se(e,"badge-info")},ce=function(e){return se(e,"emotes","/",":",",")},le=function(e,t,n,r){oe.lastIndex=0;for(var o,s=new RegExp("(\\b|^|s)"+M.unescapeHtml(t)+"(\\b|$|s)");null!==(o=oe.exec(e));)s.test(o[0])&&(r[n]=r[n]||[],r[n].push([o.index,oe.lastIndex-1]))},ue=function(e,t,n,r){var o;for(oe.lastIndex=0;null!==(o=oe.exec(e));)o[0]===M.unescapeHtml(t)&&(r[n]=r[n]||[],r[n].push([o.index,oe.lastIndex-1]))},he=function(e){var t="";return Object.keys(e).forEach(n=>{t=t+n+":",e[n].forEach(e=>{t=t+e.join("-")+","}),t=t.slice(0,-1)+"/"}),t.slice(0,-1)},fe=function(e){var t={raw:e,tags:{},prefix:null,command:null,params:[]},n=0,r=0;if(64===e.charCodeAt(0)){if(-1===(r=e.indexOf(" ")))return null;for(var o=e.slice(1,r).split(";"),s=0;s<o.length;s++){var i=o[s],a=i.split("=");t.tags[a[0]]=i.substring(i.indexOf("=")+1)||!0}n=r+1}for(;32===e.charCodeAt(n);)n++;if(58===e.charCodeAt(n)){if(-1===(r=e.indexOf(" ",n)))return null;for(t.prefix=e.slice(n+1,r),n=r+1;32===e.charCodeAt(n);)n++}if(-1===(r=e.indexOf(" ",n)))return e.length>n?(t.command=e.slice(n),t):null;for(t.command=e.slice(n,r),n=r+1;32===e.charCodeAt(n);)n++;for(;n<e.length;){if(r=e.indexOf(" ",n),58===e.charCodeAt(n)){t.params.push(e.slice(n+1));break}if(-1===r){if(-1===r){t.params.push(e.slice(n));break}}else for(t.params.push(e.slice(n,r)),n=r+1;32===e.charCodeAt(n);)n++}return t};function de(e){this.queue=[],this.index=0,this.defaultDelay=e||3e3}de.prototype.add=function(e,t){this.queue.push({fn:e,delay:t})},de.prototype.run=function(e){(e||0===e)&&(this.index=e),this.next()},de.prototype.next=function(){var e=this.index++,t=this.queue[e],n=this.queue[this.index];t&&(t.fn(),n&&setTimeout(()=>{this.next()},n.delay||this.defaultDelay))},de.prototype.reset=function(){this.index=0},de.prototype.clear=function(){this.index=0,this.queue=[]};var me={queue:de},pe=R((function(e){var t=Y.EventEmitter,n=L.WebSocket||L.MozWebSocket||B,r=function e(n){if(this instanceof e==!1)return new e(n);this.setMaxListeners(0),this.opts=M.get(n,{}),this.opts.channels=this.opts.channels||[],this.opts.connection=this.opts.connection||{},this.opts.identity=this.opts.identity||{},this.opts.options=this.opts.options||{},this.clientId=M.get(this.opts.options.clientId,null),this.maxReconnectAttempts=M.get(this.opts.connection.maxReconnectAttempts,1/0),this.maxReconnectInterval=M.get(this.opts.connection.maxReconnectInterval,3e4),this.reconnect=M.get(this.opts.connection.reconnect,!1),this.reconnectDecay=M.get(this.opts.connection.reconnectDecay,1.5),this.reconnectInterval=M.get(this.opts.connection.reconnectInterval,1e3),this.reconnecting=!1,this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.secure=M.get(this.opts.connection.secure,!1),this.emotes="",this.emotesets={},this.channels=[],this.currentLatency=0,this.globaluserstate={},this.lastJoined="",this.latency=new Date,this.moderators={},this.pingLoop=null,this.pingTimeout=null,this.reason="",this.username="",this.userstate={},this.wasCloseCalled=!1,this.ws=null;var r="error";this.opts.options.debug&&(r="info"),this.log=this.opts.logger||re;try{re.setLevel(r)}catch(e){}this.opts.channels.forEach((function(e,t,n){n[t]=M.channel(e)})),t.call(this)};for(var o in M.inherits(r,t),r.prototype.api=U,V)r.prototype[o]=V[o];r.prototype.handleMessage=function(e){if(!M.isNull(e)){this.emit("raw_message",JSON.parse(JSON.stringify(e)),e);var t=M.channel(M.get(e.params[0],null)),n=M.get(e.params[1],null),r=M.get(e.tags["msg-id"],null);if(e.tags=ie(ae(ce(e.tags))),e.tags){var o=e.tags;for(var s in o)if("emote-sets"!==s&&"ban-duration"!==s&&"bits"!==s){var i=o[s];M.isBoolean(i)?i=null:"1"===i?i=!0:"0"===i?i=!1:M.isString(i)&&(i=M.unescapeIRC(i)),o[s]=i}}if(M.isNull(e.prefix))switch(e.command){case"PING":this.emit("ping"),M.isNull(this.ws)||1!==this.ws.readyState||this.ws.send("PONG");break;case"PONG":var a=new Date;this.currentLatency=(a.getTime()-this.latency.getTime())/1e3,this.emits(["pong","_promisePing"],[[this.currentLatency]]),clearTimeout(this.pingTimeout);break;default:this.log.warn("Could not parse message with no prefix:\n"+JSON.stringify(e,null,4))}else if("tmi.twitch.tv"===e.prefix)switch(e.command){case"002":case"003":case"004":case"375":case"376":case"CAP":break;case"001":this.username=e.params[0];break;case"372":this.log.info("Connected to server."),this.userstate["#tmijs"]={},this.emits(["connected","_promiseConnect"],[[this.server,this.port],[null]]),this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.pingLoop=setInterval(()=>{M.isNull(this.ws)||1!==this.ws.readyState||this.ws.send("PING"),this.latency=new Date,this.pingTimeout=setTimeout(()=>{M.isNull(this.ws)||(this.wasCloseCalled=!1,this.log.error("Ping timeout."),this.ws.close(),clearInterval(this.pingLoop),clearTimeout(this.pingTimeout))},M.get(this.opts.connection.timeout,9999))},6e4);var c=new me.queue(2e3),l=M.union(this.opts.channels,this.channels);this.channels=[];for(var u=0;u<l.length;u++){let e=l[u];c.add(()=>{M.isNull(this.ws)||1!==this.ws.readyState||this.join(e).catch(e=>{this.log.error(e)})})}c.run();break;case"NOTICE":var h=[null],f=[t,r,n],d=[t,!0],m=[t,!1],p=[f,h],g=[f,[r]],v=`[${t}] ${n}`;switch(r){case"subs_on":this.log.info(`[${t}] This room is now in subscribers-only mode.`),this.emits(["subscriber","subscribers","_promiseSubscribers"],[d,d,h]);break;case"subs_off":this.log.info(`[${t}] This room is no longer in subscribers-only mode.`),this.emits(["subscriber","subscribers","_promiseSubscribersoff"],[m,m,h]);break;case"emote_only_on":this.log.info(`[${t}] This room is now in emote-only mode.`),this.emits(["emoteonly","_promiseEmoteonly"],[d,h]);break;case"emote_only_off":this.log.info(`[${t}] This room is no longer in emote-only mode.`),this.emits(["emoteonly","_promiseEmoteonlyoff"],[m,h]);break;case"slow_on":case"slow_off":break;case"followers_on_zero":case"followers_on":case"followers_off":break;case"r9k_on":this.log.info(`[${t}] This room is now in r9k mode.`),this.emits(["r9kmode","r9kbeta","_promiseR9kbeta"],[d,d,h]);break;case"r9k_off":this.log.info(`[${t}] This room is no longer in r9k mode.`),this.emits(["r9kmode","r9kbeta","_promiseR9kbetaoff"],[m,m,h]);break;case"room_mods":var _=n.split(": ")[1].toLowerCase().split(", ").filter(e=>e);this.emits(["_promiseMods","mods"],[[null,_],[t,_]]);break;case"no_mods":this.emits(["_promiseMods","mods"],[[null,[]],[t,[]]]);break;case"vips_success":n.endsWith(".")&&(n=n.slice(0,-1));var b=n.split(": ")[1].toLowerCase().split(", ").filter(e=>e);this.emits(["_promiseVips","vips"],[[null,b],[t,b]]);break;case"no_vips":this.emits(["_promiseVips","vips"],[[null,[]],[t,[]]]);break;case"already_banned":case"bad_ban_admin":case"bad_ban_broadcaster":case"bad_ban_global_mod":case"bad_ban_self":case"bad_ban_staff":case"usage_ban":this.log.info(v),this.emits(["notice","_promiseBan"],g);break;case"ban_success":this.log.info(v),this.emits(["notice","_promiseBan"],p);break;case"usage_clear":this.log.info(v),this.emits(["notice","_promiseClear"],g);break;case"usage_mods":this.log.info(v),this.emits(["notice","_promiseMods"],[f,[r,[]]]);break;case"mod_success":this.log.info(v),this.emits(["notice","_promiseMod"],p);break;case"usage_vips":this.log.info(v),this.emits(["notice","_promiseVips"],[f,[r,[]]]);break;case"usage_vip":case"bad_vip_grantee_banned":case"bad_vip_grantee_already_vip":this.log.info(v),this.emits(["notice","_promiseVip"],[f,[r,[]]]);break;case"vip_success":this.log.info(v),this.emits(["notice","_promiseVip"],p);break;case"usage_mod":case"bad_mod_banned":case"bad_mod_mod":this.log.info(v),this.emits(["notice","_promiseMod"],g);break;case"unmod_success":this.log.info(v),this.emits(["notice","_promiseUnmod"],p);break;case"unvip_success":this.log.info(v),this.emits(["notice","_promiseUnvip"],p);break;case"usage_unmod":case"bad_unmod_mod":this.log.info(v),this.emits(["notice","_promiseUnmod"],g);break;case"usage_unvip":case"bad_unvip_grantee_not_vip":this.log.info(v),this.emits(["notice","_promiseUnvip"],g);break;case"color_changed":this.log.info(v),this.emits(["notice","_promiseColor"],p);break;case"usage_color":case"turbo_only_color":this.log.info(v),this.emits(["notice","_promiseColor"],g);break;case"commercial_success":this.log.info(v),this.emits(["notice","_promiseCommercial"],p);break;case"usage_commercial":case"bad_commercial_error":this.log.info(v),this.emits(["notice","_promiseCommercial"],g);break;case"hosts_remaining":this.log.info(v);var y=isNaN(n[0])?0:parseInt(n[0]);this.emits(["notice","_promiseHost"],[f,[null,~~y]]);break;case"bad_host_hosting":case"bad_host_rate_exceeded":case"bad_host_error":case"usage_host":this.log.info(v),this.emits(["notice","_promiseHost"],[f,[r,null]]);break;case"already_r9k_on":case"usage_r9k_on":this.log.info(v),this.emits(["notice","_promiseR9kbeta"],g);break;case"already_r9k_off":case"usage_r9k_off":this.log.info(v),this.emits(["notice","_promiseR9kbetaoff"],g);break;case"timeout_success":this.log.info(v),this.emits(["notice","_promiseTimeout"],p);break;case"delete_message_success":this.log.info(`[${t} ${n}]`),this.emits(["notice","_promiseDeletemessage"],p);case"already_subs_off":case"usage_subs_off":this.log.info(v),this.emits(["notice","_promiseSubscribersoff"],g);break;case"already_subs_on":case"usage_subs_on":this.log.info(v),this.emits(["notice","_promiseSubscribers"],g);break;case"already_emote_only_off":case"usage_emote_only_off":this.log.info(v),this.emits(["notice","_promiseEmoteonlyoff"],g);break;case"already_emote_only_on":case"usage_emote_only_on":this.log.info(v),this.emits(["notice","_promiseEmoteonly"],g);break;case"usage_slow_on":this.log.info(v),this.emits(["notice","_promiseSlow"],g);break;case"usage_slow_off":this.log.info(v),this.emits(["notice","_promiseSlowoff"],g);break;case"usage_timeout":case"bad_timeout_admin":case"bad_timeout_broadcaster":case"bad_timeout_duration":case"bad_timeout_global_mod":case"bad_timeout_self":case"bad_timeout_staff":this.log.info(v),this.emits(["notice","_promiseTimeout"],g);break;case"untimeout_success":case"unban_success":this.log.info(v),this.emits(["notice","_promiseUnban"],p);break;case"usage_unban":case"bad_unban_no_ban":this.log.info(v),this.emits(["notice","_promiseUnban"],g);break;case"usage_delete":case"bad_delete_message_error":case"bad_delete_message_broadcaster":case"bad_delete_message_mod":this.log.info(v),this.emits(["notice","_promiseDeletemessage"],g);break;case"usage_unhost":case"not_hosting":this.log.info(v),this.emits(["notice","_promiseUnhost"],g);break;case"whisper_invalid_login":case"whisper_invalid_self":case"whisper_limit_per_min":case"whisper_limit_per_sec":case"whisper_restricted_recipient":this.log.info(v),this.emits(["notice","_promiseWhisper"],g);break;case"no_permission":case"msg_banned":case"msg_room_not_found":case"msg_channel_suspended":case"tos_ban":this.log.info(v),this.emits(["notice","_promiseBan","_promiseClear","_promiseUnban","_promiseTimeout","_promiseDeletemessage","_promiseMods","_promiseMod","_promiseUnmod","_promiseVips","_promiseVip","_promiseUnvip","_promiseCommercial","_promiseHost","_promiseUnhost","_promiseJoin","_promisePart","_promiseR9kbeta","_promiseR9kbetaoff","_promiseSlow","_promiseSlowoff","_promiseFollowers","_promiseFollowersoff","_promiseSubscribers","_promiseSubscribersoff","_promiseEmoteonly","_promiseEmoteonlyoff"],[f,[r,t]]);break;case"msg_rejected":case"msg_rejected_mandatory":this.log.info(v),this.emit("automod",t,r,n);break;case"unrecognized_cmd":this.log.info(v),this.emit("notice",t,r,n);break;case"cmds_available":case"host_target_went_offline":case"msg_censored_broadcaster":case"msg_duplicate":case"msg_emoteonly":case"msg_verified_email":case"msg_ratelimit":case"msg_subsonly":case"msg_timedout":case"msg_bad_characters":case"msg_channel_blocked":case"msg_facebook":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_slowmode":case"msg_suspended":case"no_help":case"usage_disconnect":case"usage_help":case"usage_me":this.log.info(v),this.emit("notice",t,r,n);break;case"host_on":case"host_off":break;default:n.includes("Login unsuccessful")||n.includes("Login authentication failed")||n.includes("Error logging in")||n.includes("Improperly formatted auth")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason=n,this.log.error(this.reason),this.ws.close()):n.includes("Invalid NICK")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason="Invalid NICK.",this.log.error(this.reason),this.ws.close()):this.log.warn("Could not parse NOTICE from tmi.twitch.tv:\n"+JSON.stringify(e,null,4))}break;case"USERNOTICE":var w=e.tags["display-name"]||e.tags.login,S=e.tags["msg-param-sub-plan"]||"",C=M.unescapeIRC(M.get(e.tags["msg-param-sub-plan-name"],""))||null,k={prime:S.includes("Prime"),plan:S,planName:C},x=e.tags,I=~~(e.tags["msg-param-streak-months"]||0),E=e.tags["msg-param-recipient-display-name"]||e.tags["msg-param-recipient-user-name"],N=~~e.tags["msg-param-mass-gift-count"];switch(x["message-type"]=r,r){case"resub":this.emits(["resub","subanniversary"],[[t,w,I,n,x,k]]);break;case"sub":this.emit("subscription",t,w,k,n,x);break;case"subgift":this.emit("subgift",t,w,I,E,k,x);break;case"anonsubgift":this.emit("anonsubgift",t,I,E,k,x);break;case"submysterygift":this.emit("submysterygift",t,w,N,k,x);break;case"anonsubmysterygift":this.emit("anonsubmysterygift",t,N,k,x);break;case"primepaidupgrade":this.emit("primepaidupgrade",t,w,k,x);break;case"giftpaidupgrade":var T=e.tags["msg-param-sender-name"]||e.tags["msg-param-sender-login"];this.emit("giftpaidupgrade",t,w,T,x);break;case"anongiftpaidupgrade":this.emit("anongiftpaidupgrade",t,w,x);break;case"raid":w=e.tags["msg-param-displayName"]||e.tags["msg-param-login"];var O=e.tags["msg-param-viewerCount"];this.emit("raided",t,w,O)}break;case"HOSTTARGET":var D=n.split(" ");O=~~D[1]||0;"-"===D[0]?(this.log.info(`[${t}] Exited host mode.`),this.emits(["unhost","_promiseUnhost"],[[t,O],[null]])):(this.log.info(`[${t}] Now hosting ${D[0]} for ${O} viewer(s).`),this.emit("hosting",t,D[0],O));break;case"CLEARCHAT":if(e.params.length>1){var P=M.get(e.tags["ban-duration"],null);M.isNull(P)?(this.log.info(`[${t}] ${n} has been banned.`),this.emit("ban",t,n,null,e.tags)):(this.log.info(`[${t}] ${n} has been timed out for ${P} seconds.`),this.emit("timeout",t,n,null,~~P,e.tags))}else this.log.info(`[${t}] Chat was cleared by a moderator.`),this.emits(["clearchat","_promiseClear"],[[t],[null]]);break;case"CLEARMSG":if(e.params.length>1){w=e.tags.login;var L=n;(x=e.tags)["message-type"]="messagedeleted",this.log.info(`[${t}] ${w}'s message has been deleted.`),this.emit("messagedeleted",t,w,L,x)}break;case"RECONNECT":this.log.info("Received RECONNECT request from Twitch.."),this.log.info(`Disconnecting and reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.disconnect(),setTimeout(()=>{this.connect()},this.reconnectTimer);break;case"USERSTATE":e.tags.username=this.username,"mod"===e.tags["user-type"]&&(this.moderators[this.lastJoined]||(this.moderators[this.lastJoined]=[]),this.moderators[this.lastJoined].includes(this.username)||this.moderators[this.lastJoined].push(this.username)),M.isJustinfan(this.getUsername())||this.userstate[t]||(this.userstate[t]=e.tags,this.lastJoined=t,this.channels.push(t),this.log.info("Joined "+t),this.emit("join",t,M.username(this.getUsername()),!0)),e.tags["emote-sets"]!==this.emotes&&this._updateEmoteset(e.tags["emote-sets"]),this.userstate[t]=e.tags;break;case"GLOBALUSERSTATE":this.globaluserstate=e.tags,void 0!==e.tags["emote-sets"]&&this._updateEmoteset(e.tags["emote-sets"]);break;case"ROOMSTATE":if(M.channel(this.lastJoined)===t&&this.emit("_promiseJoin",null,t),e.tags.channel=t,this.emit("roomstate",t,e.tags),!e.tags.hasOwnProperty("subs-only")){if(e.tags.hasOwnProperty("slow"))if("boolean"!=typeof e.tags.slow||e.tags.slow){var R=[t,!0,~~e.tags.slow];this.log.info(`[${t}] This room is now in slow mode.`),this.emits(["slow","slowmode","_promiseSlow"],[R,R,[null]])}else{var $=[t,!1,0];this.log.info(`[${t}] This room is no longer in slow mode.`),this.emits(["slow","slowmode","_promiseSlowoff"],[$,$,[null]])}if(e.tags.hasOwnProperty("followers-only"))if("-1"===e.tags["followers-only"]){$=[t,!1,0];this.log.info(`[${t}] This room is no longer in followers-only mode.`),this.emits(["followersonly","followersmode","_promiseFollowersoff"],[$,$,[null]])}else{R=[t,!0,~~e.tags["followers-only"]];this.log.info(`[${t}] This room is now in follower-only mode.`),this.emits(["followersonly","followersmode","_promiseFollowers"],[R,R,[null]])}}break;case"SERVERCHANGE":break;default:this.log.warn("Could not parse message from tmi.twitch.tv:\n"+JSON.stringify(e,null,4))}else if("jtv"===e.prefix)switch(e.command){case"MODE":"+o"===n?(this.moderators[t]||(this.moderators[t]=[]),this.moderators[t].includes(e.params[2])||this.moderators[t].push(e.params[2]),this.emit("mod",t,e.params[2])):"-o"===n&&(this.moderators[t]||(this.moderators[t]=[]),this.moderators[t].filter(t=>t!=e.params[2]),this.emit("unmod",t,e.params[2]));break;default:this.log.warn("Could not parse message from jtv:\n"+JSON.stringify(e,null,4))}else switch(e.command){case"353":this.emit("names",e.params[2],e.params[3].split(" "));break;case"366":break;case"JOIN":var j=e.prefix.split("!")[0];M.isJustinfan(this.getUsername())&&this.username===j&&(this.lastJoined=t,this.channels.push(t),this.log.info("Joined "+t),this.emit("join",t,j,!0)),this.username!==j&&this.emit("join",t,j,!1);break;case"PART":var A,B=!1;j=e.prefix.split("!")[0];if(this.username===j)B=!0,this.userstate[t]&&delete this.userstate[t],-1!==(A=this.channels.indexOf(t))&&this.channels.splice(A,1),-1!==(A=this.opts.channels.indexOf(t))&&this.opts.channels.splice(A,1),this.log.info("Left "+t),this.emit("_promisePart",null);this.emit("part",t,j,B);break;case"WHISPER":j=e.prefix.split("!")[0];this.log.info(`[WHISPER] <${j}>: ${n}`),e.tags.hasOwnProperty("username")||(e.tags.username=j),e.tags["message-type"]="whisper";var U=M.channel(e.tags.username);this.emits(["whisper","message"],[[U,e.tags,n,!1]]);break;case"PRIVMSG":if(e.tags.username=e.prefix.split("!")[0],"jtv"===e.tags.username){var G=M.username(n.split(" ")[0]),z=n.includes("auto");if(n.includes("hosting you for")){var F=M.extractNumber(n);this.emit("hosted",t,G,F,z)}else n.includes("hosting you")&&this.emit("hosted",t,G,0,z)}else{var H=M.actionMessage(n);H?(e.tags["message-type"]="action",this.log.info(`[${t}] *<${e.tags.username}>: ${H[1]}`),this.emits(["action","message"],[[t,e.tags,H[1],!1]])):e.tags.hasOwnProperty("bits")?this.emit("cheer",t,e.tags,n):(e.tags["message-type"]="chat",this.log.info(`[${t}] <${e.tags.username}>: ${n}`),this.emits(["chat","message"],[[t,e.tags,n,!1]]))}break;default:this.log.warn("Could not parse message:\n"+JSON.stringify(e,null,4))}}},r.prototype.connect=function(){return new Promise((e,t)=>{this.server=M.get(this.opts.connection.server,"irc-ws.chat.twitch.tv"),this.port=M.get(this.opts.connection.port,80),this.secure&&(this.port=443),443===this.port&&(this.secure=!0),this.reconnectTimer=this.reconnectTimer*this.reconnectDecay,this.reconnectTimer>=this.maxReconnectInterval&&(this.reconnectTimer=this.maxReconnectInterval),this._openConnection(),this.once("_promiseConnect",n=>{n?t(n):e([this.server,~~this.port])})})},r.prototype._openConnection=function(){this.ws=new n(`${this.secure?"wss":"ws"}://${this.server}:${this.port}/`,"irc"),this.ws.onmessage=this._onMessage.bind(this),this.ws.onerror=this._onError.bind(this),this.ws.onclose=this._onClose.bind(this),this.ws.onopen=this._onOpen.bind(this)},r.prototype._onOpen=function(){M.isNull(this.ws)||1!==this.ws.readyState||(this.log.info(`Connecting to ${this.server} on port ${this.port}..`),this.emit("connecting",this.server,~~this.port),this.username=M.get(this.opts.identity.username,M.justinfan()),this.password=M.password(M.get(this.opts.identity.password,"SCHMOOPIIE")),this.log.info("Sending authentication to server.."),this.emit("logon"),this.ws.send("CAP REQ :twitch.tv/tags twitch.tv/commands twitch.tv/membership"),this.ws.send("PASS "+this.password),this.ws.send("NICK "+this.username))},r.prototype._onMessage=function(e){e.data.split("\r\n").forEach(e=>{M.isNull(e)||this.handleMessage(fe(e))})},r.prototype._onError=function(){this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),this.reason=M.isNull(this.ws)?"Connection closed.":"Unable to connect.",this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error(`Reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.emit("reconnect"),setTimeout(()=>{this.reconnecting=!1,this.connect()},this.reconnectTimer)),this.ws=null},r.prototype._onClose=function(){this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),this.wasCloseCalled?(this.wasCloseCalled=!1,this.reason="Connection closed.",this.log.info(this.reason),this.emits(["_promiseConnect","_promiseDisconnect","disconnected"],[[this.reason],[null],[this.reason]])):(this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error(`Could not connect to server. Reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.emit("reconnect"),setTimeout(()=>{this.reconnecting=!1,this.connect()},this.reconnectTimer))),this.ws=null},r.prototype._getPromiseDelay=function(){return this.currentLatency<=600?600:this.currentLatency+100},r.prototype._sendCommand=function(e,t,n,r){return new Promise((o,s)=>{if(M.isNull(this.ws)||1!==this.ws.readyState)return s("Not connected to server.");if("number"==typeof e&&M.promiseDelay(e).then(()=>{s("No response from Twitch.")}),M.isNull(t))this.log.info("Executing command: "+n),this.ws.send(n);else{var i=M.channel(t);this.log.info(`[${i}] Executing command: ${n}`),this.ws.send(`PRIVMSG ${i} :${n}`)}r(o,s)})},r.prototype._sendMessage=function(e,t,n,r){return new Promise((o,s)=>{if(M.isNull(this.ws)||1!==this.ws.readyState)return s("Not connected to server.");if(M.isJustinfan(this.getUsername()))return s("Cannot send anonymous messages.");var i=M.channel(t);if(this.userstate[i]||(this.userstate[i]={}),n.length>=500){var a=M.splitLine(n,500);n=a[0],setTimeout(()=>{this._sendMessage(e,t,a[1],()=>{})},350)}this.ws.send(`PRIVMSG ${i} :${n}`);var c={};Object.keys(this.emotesets).forEach(e=>{this.emotesets[e].forEach((function(e){if(M.isRegex(e.code))return le(n,e.code,e.id,c);ue(n,e.code,e.id,c)}))});var l=M.merge(this.userstate[i],ce({emotes:he(c)||null})),u=M.actionMessage(n);u?(l["message-type"]="action",this.log.info(`[${i}] *<${this.getUsername()}>: ${u[1]}`),this.emits(["action","message"],[[i,l,u[1],!0]])):(l["message-type"]="chat",this.log.info(`[${i}] <${this.getUsername()}>: ${n}`),this.emits(["chat","message"],[[i,l,n,!0]])),r(o,s)})},r.prototype._updateEmoteset=function(e){this.emotes=e,this.api({url:"/chat/emoticon_images?emotesets="+e,headers:{Authorization:"OAuth "+M.password(M.get(this.opts.identity.password,"")).replace("oauth:",""),"Client-ID":this.clientId}},(t,n,r)=>{if(!t)return this.emotesets=r.emoticon_sets||{},this.emit("emotesets",e,this.emotesets);setTimeout(()=>{this._updateEmoteset(e)},6e4)})},r.prototype.getUsername=function(){return this.username},r.prototype.getOptions=function(){return this.opts},r.prototype.getChannels=function(){return this.channels},r.prototype.isMod=function(e,t){var n=M.channel(e);return this.moderators[n]||(this.moderators[n]=[]),this.moderators[n].includes(M.username(t))},r.prototype.readyState=function(){return M.isNull(this.ws)?"CLOSED":["CONNECTING","OPEN","CLOSING","CLOSED"][this.ws.readyState]},r.prototype.disconnect=function(){return new Promise((e,t)=>{M.isNull(this.ws)||3===this.ws.readyState?(this.log.error("Cannot disconnect from server. Socket is not opened or connection is already closing."),t("Cannot disconnect from server. Socket is not opened or connection is already closing.")):(this.wasCloseCalled=!0,this.log.info("Disconnecting from server.."),this.ws.close(),this.once("_promiseDisconnect",()=>{e([this.server,~~this.port])}))})},e.exports&&(e.exports=r),"undefined"!=typeof window&&(window.tmi={},window.tmi.client=r,window.tmi.Client=r)})),ge={client:pe,Client:pe},ve=R((function(e){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){n.r(t),n.d(t,"validateHTMLColorName",(function(){return i})),n.d(t,"validateHTMLColorSpecialName",(function(){return a})),n.d(t,"validateHTMLColorHex",(function(){return c})),n.d(t,"validateHTMLColorRgb",(function(){return l})),n.d(t,"validateHTMLColorHsl",(function(){return f})),n.d(t,"validateHTMLColorHwb",(function(){return d})),n.d(t,"validateHTMLColorLab",(function(){return m})),n.d(t,"validateHTMLColor",(function(){return p}));const r=e=>e&&"string"==typeof e,o=["AliceBlue","AntiqueWhite","Aqua","Aquamarine","Azure","Beige","Bisque","Black","BlanchedAlmond","Blue","BlueViolet","Brown","BurlyWood","CadetBlue","Chartreuse","Chocolate","Coral","CornflowerBlue","Cornsilk","Crimson","Cyan","DarkBlue","DarkCyan","DarkGoldenrod","DarkGray","DarkGreen","DarkKhaki","DarkMagenta","DarkOliveGreen","DarkOrange","DarkOrchid","DarkRed","DarkSalmon","DarkSeaGreen","DarkSlateBlue","DarkSlateGray","DarkTurquoise","DarkViolet","DeepPink","DeepSkyBlue","DimGray","DodgerBlue","FireBrick","FloralWhite","ForestGreen","Fuchsia","Gainsboro","GhostWhite","Gold","Goldenrod","Gray","Green","GreenYellow","HoneyDew","HotPink","IndianRed","Indigo","Ivory","Khaki","Lavender","LavenderBlush","LawnGreen","LemonChiffon","LightBlue","LightCoral","LightCyan","LightGoldenrodYellow","LightGray","LightGreen","LightPink","LightSalmon","LightSalmon","LightSeaGreen","LightSkyBlue","LightSlateGray","LightSteelBlue","LightYellow","Lime","LimeGreen","Linen","Magenta","Maroon","MediumAquamarine","MediumBlue","MediumOrchid","MediumPurple","MediumSeaGreen","MediumSlateBlue","MediumSlateBlue","MediumSpringGreen","MediumTurquoise","MediumVioletRed","MidnightBlue","MintCream","MistyRose","Moccasin","NavajoWhite","Navy","OldLace","Olive","OliveDrab","Orange","OrangeRed","Orchid","PaleGoldenrod","PaleGreen","PaleTurquoise","PaleVioletRed","PapayaWhip","PeachPuff","Peru","Pink","Plum","PowderBlue","Purple","RebeccaPurple","Red","RosyBrown","RoyalBlue","SaddleBrown","Salmon","SandyBrown","SeaGreen","SeaShell","Sienna","Silver","SkyBlue","SlateBlue","SlateGray","Snow","SpringGreen","SteelBlue","Tan","Teal","Thistle","Tomato","Turquoise","Violet","Wheat","White","WhiteSmoke","Yellow","YellowGreen"],s=["currentColor","inherit","transparent"],i=e=>{let t=!1;return r(e)&&o.map(n=>(e.toLowerCase()===n.toLowerCase()&&(t=!0),null)),t},a=e=>{let t=!1;return r(e)&&s.map(n=>(e.toLowerCase()===n.toLowerCase()&&(t=!0),null)),t},c=e=>{if(r(e)){const t=/^#([\da-f]{3}){1,2}$|^#([\da-f]{4}){1,2}$/i;return e&&t.test(e)}},l=e=>{if(r(e)){const t=/(rgb)a?\((\s*\d+%?\s*?,?\s*){2}(\s*\d+%?\s*?,?\s*\)?)(\s*,?\s*\/?\s*(0?\.?\d+%?\s*)?|1|0)?\)$/i;return e&&t.test(e)}},u="(([0-9]|[1-9][0-9]|100)%)",h=`\\s*?\\)?)(\\s*?(\\/?)\\s+(((${u}))|(0?(\\.\\d+)?)|1))?\\s*?\\)$`,f=e=>{if(r(e)){const t=new RegExp(`(hsl)a?\\((\\s*?((-?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-9][0-9]|3[0-5][0-9]|360)(deg)?)|(([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-9][0-9]|3[0-9][0-9]|400)gra)|((([0-5])?\\.\\d+|6\\.([0-9]|1[0-9]|2[0-8])|[0-6])rad)|((0?(\\.\\d+)?|1)turn))((\\s*,\\s*)|(\\s+)))(\\s*?(0|${u})((\\s*,\\s*)|(\\s+)))(\\s*?(0|${u})\\s*?\\)?)(\\s*?(\\/?|,?)\\s*?(((${u}))|(0?(\\.\\d+)?)|1))?\\)$`);return e&&t.test(e)}},d=e=>{if(r(e)){const t=new RegExp(`(hwb\\(\\s*?(-?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-9][0-9]|3[0-5][0-9]|360)(deg)?)\\s+)((0|${u})\\s+)((0|${u})${h}`);return e&&t.test(e)}},m=e=>{if(r(e)){const t="(-?(([0-9]|[1-9][0-9]|1[0-5][0-9])(\\.\\d+)??|160))",n=new RegExp(`(lab\\(\\s*?((\\d*(\\.\\d+)?)%)\\s+${t}\\s+${t}${h}`);return e&&n.test(e)}},p=e=>!!(e&&c(e)||l(e)||f(e)||d(e)||m(e));t.default=e=>!!(e&&c(e)||i(e)||a(e)||l(e)||f(e)||d(e)||m(e))}])}));const{validateHTMLColorName:_e,validateHTMLColorSpecialName:be,validateHTMLColorHex:ye}=ve,we=["me","random"];function Se(e){return void 0!==e&&(!!we.includes(e)||!!(_e(e)||be(e)||ye(e)))}const Ce=/([A-Za-z]+)(\d+)/g;class ke{parseCheer(e,t,n){const r={action:"add",value:null,badges:n.badges,username:t},o=new Array(...e.matchAll(Ce));if(o&&o.length>0){const[e,t,s]=o[0];return r.value={cheer:!0,color:n.color,emote:t},console.info({result:r}),r}return null}parseCommand(e,t,n){const r={action:"",value:null,badges:n.badges,username:t},o=(null==n?void 0:n.emotes)?Object.keys(n.emotes):[];if(console.info({emotes:o,message:e,tags:n}),e.includes("!pixel"))if(e.includes(":")){const[t,n]=e.split("="),[o,s]=t.split(":");r.action=s,r.value={color:n}}else{const t=e.replace("!pixel","").trim(),[n,o]=t.split(" ");r.action=n,r.value={color:o}}else{if(console.info({emotes:o}),!(o.length>0))return null;r.action="add",r.value={color:"me"},console.info("Emote exist  :)",JSON.stringify(r))}if("add"===r.action){if(!Se(r.value.color))return console.info("invalid",r.value),null;"me"===r.value.color&&(console.info("setting tags color",n),r.value={color:n.color},console.info("changed to result",JSON.stringify(r))),o.length>0&&(r.value={color:r.value.color,emote:o[0]},console.info("after emote added",JSON.stringify(r)))}return r}}class xe{commandReceived$=P(null);_channelName="";_commandValidator=new ke;constructor(e){this._channelName=e;const t=new ge.Client({connection:{secure:!0,reconnect:!0},channels:[e]});console.info({channelName:e}),t.connect(),t.on("message",(e,t,n,r)=>{const o=t.username;console.info({channel:e,tags:t,message:n,self:r});const s=this._commandValidator.parseCommand(n,o,t);console.info({command:s}),this.commandReceived$.set(s)}),t.on("cheer",(e,t,n,...r)=>{const o=t.username;console.info("cheer",{channel:e,tags:t,message:n,rest:r});const s=this._commandValidator.parseCheer(n,o,t);s&&(console.info({command:s}),this.commandReceived$.set(s))})}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function Ie(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))}var Ee=R((function(e,t){
/*!
        localForage -- Offline Storage, Improved
        Version 1.7.4
        https://localforage.github.io/localForage
        (c) 2013-2017 Mozilla, Apache License 2.0
    */
e.exports=function e(t,n,r){function o(i,a){if(!n[i]){if(!t[i]){if(!a&&$)return $();if(s)return s(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[i]={exports:{}};t[i][0].call(l.exports,(function(e){var n=t[i][1][e];return o(n||e)}),l,l.exports,e,t,n,r)}return n[i].exports}for(var s=$,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t,n){(function(e){var n,r,o=e.MutationObserver||e.WebKitMutationObserver;if(o){var s=0,i=new o(u),a=e.document.createTextNode("");i.observe(a,{characterData:!0}),n=function(){a.data=s=++s%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var c=new e.MessageChannel;c.port1.onmessage=u,n=function(){c.port2.postMessage(0)}}var l=[];function u(){var e,t;r=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}r=!1}t.exports=function(e){1!==l.push(e)||r||n()}}).call(this,void 0!==L?L:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){var r=e(1);function o(){}var s={},i=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==o&&d(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function h(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return s.reject(e,t)}r===e?s.reject(e,new TypeError("Cannot resolve promise with itself")):s.resolve(e,r)}))}function f(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function d(e,t){var n=!1;function r(t){n||(n=!0,s.reject(e,t))}function o(t){n||(n=!0,s.resolve(e,t))}var i=m((function(){t(o,r)}));"error"===i.status&&r(i.value)}function m(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}t.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===i)return this;var n=new this.constructor(o);return this.state!==c?h(n,this.state===a?e:t,this.outcome):this.queue.push(new u(n,e,t)),n},u.prototype.callFulfilled=function(e){s.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){h(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){s.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){h(this.promise,this.onRejected,e)},s.resolve=function(e,t){var n=m(f,t);if("error"===n.status)return s.reject(e,n.value);var r=n.value;if(r)d(e,r);else{e.state=a,e.outcome=t;for(var o=-1,i=e.queue.length;++o<i;)e.queue[o].callFulfilled(t)}return e},s.reject=function(e,t){e.state=i,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},l.resolve=function(e){return e instanceof this?e:s.resolve(new this(o),e)},l.reject=function(e){var t=new this(o);return s.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var i=new Array(n),a=0,c=-1,l=new this(o);++c<n;)u(e[c],c);return l;function u(e,o){t.resolve(e).then((function(e){i[o]=e,++a!==n||r||(r=!0,s.resolve(l,i))}),(function(e){r||(r=!0,s.reject(l,e))}))}},l.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var i,a=-1,c=new this(o);++a<n;)i=e[a],t.resolve(i).then((function(e){r||(r=!0,s.resolve(c,e))}),(function(e){r||(r=!0,s.reject(c,e))}));return c}},{1:1}],3:[function(e,t,n){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==L?L:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function s(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if("TypeError"!==o.name)throw o;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var i=Promise;function a(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function c(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function l(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function u(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var h=void 0,f={},d=Object.prototype.toString;function m(e){return"boolean"==typeof h?i.resolve(h):function(e){return new i((function(t){var n=e.transaction("local-forage-detect-blob-support","readwrite"),r=s([""]);n.objectStore("local-forage-detect-blob-support").put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return h=e}))}function p(e){var t=f[e.name],n={};n.promise=new i((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function g(e){var t=f[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function v(e,t){var n=f[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function _(e,t){return new i((function(n,r){if(f[e.name]=f[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);p(e),e.db.close()}var s=[e.name];t&&s.push(e.version);var i=o.open.apply(o,s);t&&(i.onupgradeneeded=function(t){var n=i.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore("local-forage-detect-blob-support")}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),i.onerror=function(e){e.preventDefault(),r(i.error)},i.onsuccess=function(){n(i.result),g(e)}}))}function b(e){return _(e,!1)}function y(e){return _(e,!0)}function w(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,o=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),o||n){if(n){var s=e.db.version+1;s>e.version&&(e.version=s)}return!0}return!1}function S(e){return s([function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),o=0;o<t;o++)r[o]=e.charCodeAt(o);return n}(atob(e.data))],{type:e.type})}function C(e){return e&&e.__local_forage_encoded_blob}function k(e){var t=this,n=t._initReady().then((function(){var e=f[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return c(n,e,e),n}function x(e,t,n,r){void 0===r&&(r=1);try{var o=e.db.transaction(e.storeName,t);n(null,o)}catch(o){if(r>0&&(!e.db||"InvalidStateError"===o.name||"NotFoundError"===o.name))return i.resolve().then((function(){if(!e.db||"NotFoundError"===o.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),y(e)})).then((function(){return function(e){p(e);for(var t=f[e.name],n=t.forages,r=0;r<n.length;r++){var o=n[r];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return e.db=null,b(e).then((function(t){return e.db=t,w(e)?y(e):t})).then((function(r){e.db=t.db=r;for(var o=0;o<n.length;o++)n[o]._dbInfo.db=r})).catch((function(t){throw v(e,t),t}))}(e).then((function(){x(e,t,n,r-1)}))})).catch(n);n(o)}}var I={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var o=f[n.name];o||(o={forages:[],db:null,dbReady:null,deferredOperations:[]},f[n.name]=o),o.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=k);var s=[];function a(){return i.resolve()}for(var c=0;c<o.forages.length;c++){var l=o.forages[c];l!==t&&s.push(l._initReady().catch(a))}var u=o.forages.slice(0);return i.all(s).then((function(){return n.db=o.db,b(n)})).then((function(e){return n.db=e,w(n,t._defaultConfig.version)?y(n):e})).then((function(e){n.db=o.db=e,t._dbInfo=n;for(var r=0;r<u.length;r++){var s=u[r];s!==t&&(s._dbInfo.db=n.db,s._dbInfo.version=n.version)}}))},_support:function(){try{if(!o||!o.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=new i((function(t,r){n.ready().then((function(){x(n._dbInfo,"readonly",(function(o,s){if(o)return r(o);try{var i=s.objectStore(n._dbInfo.storeName).openCursor(),a=1;i.onsuccess=function(){var n=i.result;if(n){var r=n.value;C(r)&&(r=S(r));var o=e(r,n.key,a++);void 0!==o?t(o):n.continue()}else t()},i.onerror=function(){r(i.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=new i((function(t,r){n.ready().then((function(){x(n._dbInfo,"readonly",(function(o,s){if(o)return r(o);try{var i=s.objectStore(n._dbInfo.storeName).get(e);i.onsuccess=function(){var e=i.result;void 0===e&&(e=null),C(e)&&(e=S(e)),t(e)},i.onerror=function(){r(i.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,t),r},setItem:function(e,t,n){var r=this;e=l(e);var o=new i((function(n,o){var s;r.ready().then((function(){return s=r._dbInfo,"[object Blob]"===d.call(t)?m(s.db).then((function(e){return e?t:(n=t,new i((function(e,t){var r=new FileReader;r.onerror=t,r.onloadend=function(t){var r=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:n.type})},r.readAsBinaryString(n)})));var n})):t})).then((function(t){x(r._dbInfo,"readwrite",(function(s,i){if(s)return o(s);try{var a=i.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);i.oncomplete=function(){void 0===t&&(t=null),n(t)},i.onabort=i.onerror=function(){var e=c.error?c.error:c.transaction.error;o(e)}}catch(e){o(e)}}))})).catch(o)}));return a(o,n),o},removeItem:function(e,t){var n=this;e=l(e);var r=new i((function(t,r){n.ready().then((function(){x(n._dbInfo,"readwrite",(function(o,s){if(o)return r(o);try{var i=s.objectStore(n._dbInfo.storeName).delete(e);s.oncomplete=function(){t()},s.onerror=function(){r(i.error)},s.onabort=function(){var e=i.error?i.error:i.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return a(r,t),r},clear:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){x(t._dbInfo,"readwrite",(function(r,o){if(r)return n(r);try{var s=o.objectStore(t._dbInfo.storeName).clear();o.oncomplete=function(){e()},o.onabort=o.onerror=function(){var e=s.error?s.error:s.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return a(n,e),n},length:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){x(t._dbInfo,"readonly",(function(r,o){if(r)return n(r);try{var s=o.objectStore(t._dbInfo.storeName).count();s.onsuccess=function(){e(s.result)},s.onerror=function(){n(s.error)}}catch(e){n(e)}}))})).catch(n)}));return a(n,e),n},key:function(e,t){var n=this,r=new i((function(t,r){e<0?t(null):n.ready().then((function(){x(n._dbInfo,"readonly",(function(o,s){if(o)return r(o);try{var i=s.objectStore(n._dbInfo.storeName),a=!1,c=i.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||a?t(n.key):(a=!0,n.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,t),r},keys:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){x(t._dbInfo,"readonly",(function(r,o){if(r)return n(r);try{var s=o.objectStore(t._dbInfo.storeName).openKeyCursor(),i=[];s.onsuccess=function(){var t=s.result;t?(i.push(t.key),t.continue()):e(i)},s.onerror=function(){n(s.error)}}catch(e){n(e)}}))})).catch(n)}));return a(n,e),n},dropInstance:function(e,t){t=u.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,s=this;if(e.name){var c=e.name===n.name&&s._dbInfo.db,l=c?i.resolve(s._dbInfo.db):b(e).then((function(t){var n=f[e.name],r=n.forages;n.db=t;for(var o=0;o<r.length;o++)r[o]._dbInfo.db=t;return t}));r=e.storeName?l.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;p(e);var r=f[e.name],s=r.forages;t.close();for(var a=0;a<s.length;a++){var c=s[a];c._dbInfo.db=null,c._dbInfo.version=n}return new i((function(t,r){var s=o.open(e.name,n);s.onerror=function(e){s.result.close(),r(e)},s.onupgradeneeded=function(){s.result.deleteObjectStore(e.storeName)},s.onsuccess=function(){var e=s.result;e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<s.length;t++){var n=s[t];n._dbInfo.db=e,g(n._dbInfo)}})).catch((function(t){throw(v(e,t)||i.resolve()).catch((function(){})),t}))}})):l.then((function(t){p(e);var n=f[e.name],r=n.forages;t.close();for(var s=0;s<r.length;s++)r[s]._dbInfo.db=null;return new i((function(t,n){var r=o.deleteDatabase(e.name);r.onerror=r.onblocked=function(e){var t=r.result;t&&t.close(),n(e)},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<r.length;t++)g(r[t]._dbInfo)})).catch((function(t){throw(v(e,t)||i.resolve()).catch((function(){})),t}))}))}else r=i.reject("Invalid arguments");return a(r,t),r}},E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",N=/^~~local_forage_type~([^~]+)~/,T="__lfsc__:".length,O=T+"arbf".length,D=Object.prototype.toString;function P(e){var t,n,r,o,s,i=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var l=new ArrayBuffer(i),u=new Uint8Array(l);for(t=0;t<a;t+=4)n=E.indexOf(e[t]),r=E.indexOf(e[t+1]),o=E.indexOf(e[t+2]),s=E.indexOf(e[t+3]),u[c++]=n<<2|r>>4,u[c++]=(15&r)<<4|o>>2,u[c++]=(3&o)<<6|63&s;return l}function L(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=E[n[t]>>2],r+=E[(3&n[t])<<4|n[t+1]>>4],r+=E[(15&n[t+1])<<2|n[t+2]>>6],r+=E[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var R={serialize:function(e,t){var n="";if(e&&(n=D.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===D.call(e.buffer))){var r,o="__lfsc__:";e instanceof ArrayBuffer?(r=e,o+="arbf"):(r=e.buffer,"[object Int8Array]"===n?o+="si08":"[object Uint8Array]"===n?o+="ui08":"[object Uint8ClampedArray]"===n?o+="uic8":"[object Int16Array]"===n?o+="si16":"[object Uint16Array]"===n?o+="ur16":"[object Int32Array]"===n?o+="si32":"[object Uint32Array]"===n?o+="ui32":"[object Float32Array]"===n?o+="fl32":"[object Float64Array]"===n?o+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(o+L(r))}else if("[object Blob]"===n){var s=new FileReader;s.onload=function(){var n="~~local_forage_type~"+e.type+"~"+L(this.result);t("__lfsc__:blob"+n)},s.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if("__lfsc__:"!==e.substring(0,T))return JSON.parse(e);var t,n=e.substring(O),r=e.substring(T,O);if("blob"===r&&N.test(n)){var o=n.match(N);t=o[1],n=n.substring(o[0].length)}var i=P(n);switch(r){case"arbf":return i;case"blob":return s([i],{type:t});case"si08":return new Int8Array(i);case"ui08":return new Uint8Array(i);case"uic8":return new Uint8ClampedArray(i);case"si16":return new Int16Array(i);case"ur16":return new Uint16Array(i);case"si32":return new Int32Array(i);case"ui32":return new Uint32Array(i);case"fl32":return new Float32Array(i);case"fl64":return new Float64Array(i);default:throw new Error("Unkown type: "+r)}},stringToBuffer:P,bufferToString:L};function $(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function j(e,t,n,r,o,s){e.executeSql(n,r,o,(function(e,i){i.code===i.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?s(e,i):$(e,t,(function(){e.executeSql(n,r,o,s)}),s)}),s):s(e,i)}),s)}function A(e,t,n,r){var o=this;e=l(e);var s=new i((function(s,i){o.ready().then((function(){void 0===t&&(t=null);var a=t,c=o._dbInfo;c.serializer.serialize(t,(function(t,l){l?i(l):c.db.transaction((function(n){j(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){s(a)}),(function(e,t){i(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void s(A.apply(o,[e,a,n,r-1]));i(t)}}))}))})).catch(i)}));return a(s,n),s}function M(e){return new i((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var o=[],s=0;s<r.rows.length;s++)o.push(r.rows.item(s).name);t({db:e,storeNames:o})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}var B={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var o=new i((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(o){$(o,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=R,o},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,r=new i((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){j(n,o,"SELECT * FROM "+o.storeName,[],(function(n,r){for(var s=r.rows,i=s.length,a=0;a<i;a++){var c=s.item(a),l=c.value;if(l&&(l=o.serializer.deserialize(l)),void 0!==(l=e(l,c.key,a+1)))return void t(l)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=new i((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){j(n,o,"SELECT * FROM "+o.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=o.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,t),r},setItem:function(e,t,n){return A.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=l(e);var r=new i((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){j(n,o,"DELETE FROM "+o.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,t),r},clear:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){j(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,e),n},length:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){j(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,e),n},key:function(e,t){var n=this,r=new i((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){j(n,o,"SELECT key FROM "+o.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,t),r},keys:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){j(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],o=0;o<n.rows.length;o++)r.push(n.rows.item(o).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,e),n},dropInstance:function(e,t){t=u.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,o=this;return a(r=e.name?new i((function(t){var r;r=e.name===n.name?o._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(M(r))})).then((function(e){return new i((function(t,n){e.db.transaction((function(r){function o(e){return new i((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var s=[],a=0,c=e.storeNames.length;a<c;a++)s.push(o(e.storeNames[a]));i.all(s).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):i.reject("Invalid arguments"),t),r}};function U(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function G(){return!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}()||localStorage.length>0}var z={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=U(e,this._defaultConfig),G()?(this._dbInfo=t,t.serializer=R,i.resolve()):i.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,o=r.length,s=localStorage.length,i=1,a=0;a<s;a++){var c=localStorage.key(a);if(0===c.indexOf(r)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(o),i++)))return l}}}));return a(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return a(r,t),r},setItem:function(e,t,n){var r=this;e=l(e);var o=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new i((function(o,s){var i=r._dbInfo;i.serializer.serialize(t,(function(t,r){if(r)s(r);else try{localStorage.setItem(i.keyPrefix+e,t),o(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||s(e),s(e)}}))}))}));return a(o,n),o},removeItem:function(e,t){var n=this;e=l(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return a(r,t),r},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return a(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return a(t,e),t},key:function(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return a(r,t),r},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],o=0;o<n;o++){var s=localStorage.key(o);0===s.indexOf(e.keyPrefix)&&r.push(s.substring(e.keyPrefix.length))}return r}));return a(n,e),n},dropInstance:function(e,t){if(t=u.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,o=this;return a(r=e.name?new i((function(t){e.storeName?t(U(e,o._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):i.reject("Invalid arguments"),t),r}},F=function(e,t){for(var n,r,o=e.length,s=0;s<o;){if((n=e[s])===(r=t)||"number"==typeof n&&"number"==typeof r&&isNaN(n)&&isNaN(r))return!0;s++}return!1},H=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},q={},W={},J={INDEXEDDB:I,WEBSQL:B,LOCALSTORAGE:z},V=[J.INDEXEDDB._driver,J.WEBSQL._driver,J.LOCALSTORAGE._driver],K=["dropInstance"],Y=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(K),Q={description:"",driver:V.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function X(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function Z(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(H(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var ee=new(function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),J)if(J.hasOwnProperty(n)){var r=J[n],o=r._driver;this[n]=o,q[o]||this.defineDriver(r)}this._defaultConfig=Z({},Q),this._config=Z({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new i((function(t,n){try{var r=e._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(o);for(var s=Y.concat("_initStorage"),c=0,l=s.length;c<l;c++){var u=s[c];if((!F(K,u)||e[u])&&"function"!=typeof e[u])return void n(o)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=i.reject(t);return a(n,arguments[arguments.length-1]),n}},n=0,r=K.length;n<r;n++){var o=K[n];e[o]||(e[o]=t(o))}}();var h=function(n){q[r]&&console.info("Redefining LocalForage driver: "+r),q[r]=e,W[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(h,n):h(!!e._support):h(!0)}catch(e){n(e)}}));return c(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=q[e]?i.resolve(q[e]):i.reject(new Error("Driver not found."));return c(r,t,n),r},e.prototype.getSerializer=function(e){var t=i.resolve(R);return c(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return c(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;H(e)||(e=[e]);var o=this._getSupportedDrivers(e);function s(){r._config.driver=r.driver()}function a(e){return r._extend(e),s(),r._ready=r._initStorage(r._config),r._ready}var l=null!==this._driverSet?this._driverSet.catch((function(){return i.resolve()})):i.resolve();return this._driverSet=l.then((function(){var e=o[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,s(),r._wrapLibraryMethodsWithReady(),r._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var o=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(o).then(a).catch(n)}s();var c=new Error("No available storage method found.");return r._driverSet=i.reject(c),r._driverSet}()}}(o)}))})).catch((function(){s();var e=new Error("No available storage method found.");return r._driverSet=i.reject(e),r._driverSet})),c(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!W[e]},e.prototype._extend=function(e){Z(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var o=e[n];this.supports(o)&&t.push(o)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=Y.length;e<t;e++)X(this,Y[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=ee},{3:3}]},{},[4])(4)}));class Ne{constructor(e){this._cellCount=e,this.pixelStore$=P(null)}init(){return Ie(this,void 0,void 0,(function*(){yield this.loadPixels(),this.pixelStore$.subscribe(e=>{e&&(console.info({newValues:e}),Ee.setItem("pixels@v1",e))})}))}loadPixels(){return Ie(this,void 0,void 0,(function*(){const e=(yield Ee.getItem("pixels@v1"))||{};return console.info({savedPixels:e}),this.pixelStore$.set(e),e}))}addPixel(e){this._insertPixel(e)}_insertPixel(e){this.pixelStore$.update(t=>{for(let e=this._cellCount;e>=0;e--)t[e+1]=t[e];return t[0]=e,t})}updatePixels(e){this.pixelStore$.set(e)}}function Te(e){const t={};return Object.keys(e).forEach(n=>{const r=e[n];r&&(t[n]="string"==typeof r?{color:r}:r)}),t}class Oe{constructor(e){this._pixelz=null,this.lastMessageByUser={},this._pixelz=e}canExecute(e){if(console.info({command:e}),e.badges&&"1"===e.badges.broadcaster)return!0;if(e.value.cheer)return!0;if("cleanup"===e.action)return!1;const t=this.lastMessageByUser[e.username];if(t){if((new Date).getTime()-t.getTime()<1e4)return!1}return this.lastMessageByUser[e.username]=new Date,!0}handle(e){return Ie(this,void 0,void 0,(function*(){if(!this.canExecute(e))return!1;const{action:t,value:n}=e;switch(console.info({action:t,value:n}),t){case"add":this._pixelz.addPixel(n);break;case"cleanup":{const e=Te(yield this._pixelz.loadPixels()),t=Object.keys(e),n=[],r=[];t.forEach(t=>{const o=e[t];Se(o.color)||n.push(t),r.push(o)});for(const e of n.reverse())r.splice(+e,1);const o={};for(let e=0;e<r.length;e++)o[e]=r[e];console.info({newPixelsObject:o}),this._pixelz.updatePixels(o);break}}}))}}function De(e,t,n){const r=e.slice();return r[21]=t[n],r}function Pe(e){let t;function n(e,t){return e[1][e[21]].cheer?Re:Le}let r=n(e),o=r(e);return{c(){o.c(),t=u("")},m(e,n){o.m(e,n),a(e,t,n)},p(e,s){r===(r=n(e))&&o?o.p(e,s):(o.d(1),o=r(e),o&&(o.c(),o.m(t.parentNode,t)))},d(e){o.d(e),e&&c(t)}}}function Le(e){let t,n;return{c(){t=l("img"),t.src!==(n="https://static-cdn.jtvnw.net/emoticons/v1/"+e[1][e[21]].emote+"/2.0")&&h(t,"src",n),h(t,"alt","an emote, no name available sorry"),h(t,"class","svelte-1gdatnt")},m(e,n){a(e,t,n)},p(e,r){3&r&&t.src!==(n="https://static-cdn.jtvnw.net/emoticons/v1/"+e[1][e[21]].emote+"/2.0")&&h(t,"src",n)},d(e){e&&c(t)}}}function Re(e){let t,n;return{c(){t=l("img"),t.src!==(n="https://d3aqoihi2n8ty8.cloudfront.net/actions/"+Ae(e[1][e[21]].emote)+"/dark/animated/1/2.gif")&&h(t,"src",n),h(t,"alt","an emote, no name available sorry"),h(t,"class","svelte-1gdatnt")},m(e,n){a(e,t,n)},p(e,r){3&r&&t.src!==(n="https://d3aqoihi2n8ty8.cloudfront.net/actions/"+Ae(e[1][e[21]].emote)+"/dark/animated/1/2.gif")&&h(t,"src",n)},d(e){e&&c(t)}}}function $e(e){let t,n,r,o,s=e[1][e[21]]&&null!=e[1][e[21]].emote&&Pe(e);return{c(){t=l("div"),s&&s.c(),n=u(" "),f(t,"background",e[1][e[21]]&&e[1][e[21]].color||"inherited"),f(t,"--animate-delay",e[21]*e[6]+"ms"),h(t,"data-index",r=e[21]),h(t,"class",o="cell "+(e[1][e[21]]&&e[1][e[21]].color)+" "+(e[5]&&"shadow")+" svelte-1gdatnt")},m(e,r){a(e,t,r),s&&s.m(t,null),i(t,n)},p(e,i){e[1][e[21]]&&null!=e[1][e[21]].emote?s?s.p(e,i):(s=Pe(e),s.c(),s.m(t,n)):s&&(s.d(1),s=null),3&i&&f(t,"background",e[1][e[21]]&&e[1][e[21]].color||"inherited"),1&i&&f(t,"--animate-delay",e[21]*e[6]+"ms"),1&i&&r!==(r=e[21])&&h(t,"data-index",r),3&i&&o!==(o="cell "+(e[1][e[21]]&&e[1][e[21]].color)+" "+(e[5]&&"shadow")+" svelte-1gdatnt")&&h(t,"class",o)},d(e){e&&c(t),s&&s.d()}}}function je(t){let n,r,o,s=T(0,t[0],1),u=[];for(let e=0;e<s.length;e+=1)u[e]=$e(De(t,s,e));return{c(){n=l("main"),r=l("div");for(let e=0;e<u.length;e+=1)u[e].c();h(r,"class",o="cell-holder "+t[2]+" svelte-1gdatnt"),f(r,"--cell-size",t[3]),f(r,"--cell-gap",t[4])},m(e,t){a(e,n,t),i(n,r);for(let e=0;e<u.length;e+=1)u[e].m(r,null)},p(e,[t]){if(99&t){let n;for(s=T(0,e[0],1),n=0;n<s.length;n+=1){const o=De(e,s,n);u[n]?u[n].p(o,t):(u[n]=$e(o),u[n].c(),u[n].m(r,null))}for(;n<u.length;n+=1)u[n].d(1);u.length=s.length}},i:e,o:e,d(e){e&&c(n),function(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(u,e)}}}function Ae(e){return e.toLowerCase()}function Me(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))};const o=new O,s=o.getDirection(),i=o.getCellSize(),a=o.getCellGap(),c=o.getShadow(),l=o.getAnimationDelay(),u=o.getIgnoredUsers(),h=new xe(o.getChannel()),f=new Ne(o.getCells()),d=new Oe(f);h.commandReceived$.subscribe(e=>{e&&(e.username&&u.includes(e.username)||d.handle(e))});const m=f.pixelStore$;let p=o.getCells(),g={};m.subscribe(e=>{if(!e)return;const t=Te(e);n(1,g=t)});return function(){r(this,void 0,void 0,(function*(){yield f.init()}))}(),[p,g,s,i,a,c,l]}return new class extends class{$destroy(){!function(e,t){const n=e.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}{constructor(e){super(),N(this,e,Me,je,s,{})}}({target:document.body,props:{name:"world"}})}();
//# sourceMappingURL=bundle.js.map
