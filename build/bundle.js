var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function r(e){e.forEach(t)}function s(e){return"function"==typeof e}function o(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function i(e,t){e.appendChild(t)}function a(e,t,n){e.insertBefore(t,n||null)}function c(e){e.parentNode.removeChild(e)}function l(e){return document.createElement(e)}function u(){return e=" ",document.createTextNode(e);var e}function h(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function f(e,t,n,r){e.style.setProperty(t,n,r?"important":"")}let m;function d(e){m=e}const p=[],g=[],_=[],v=[],b=Promise.resolve();let y=!1;function w(e){_.push(e)}let C=!1;const S=new Set;function I(){if(!C){C=!0;do{for(let e=0;e<p.length;e+=1){const t=p[e];d(t),k(t.$$)}for(p.length=0;g.length;)g.pop()();for(let e=0;e<_.length;e+=1){const t=_[e];S.has(t)||(S.add(t),t())}_.length=0}while(p.length);for(;v.length;)v.pop()();y=!1,C=!1,S.clear()}}function k(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(w)}}const E=new Set;function x(e,t){-1===e.$$.dirty[0]&&(p.push(e),y||(y=!0,b.then(I)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function N(o,i,a,l,u,h,f=[-1]){const p=m;d(o);const g=i.props||{},_=o.$$={fragment:null,ctx:null,props:h,update:e,not_equal:u,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(p?p.$$.context:[]),callbacks:n(),dirty:f};let v=!1;if(_.ctx=a?a(o,g,(e,t,...n)=>{const r=n.length?n[0]:t;return _.ctx&&u(_.ctx[e],_.ctx[e]=r)&&(_.bound[e]&&_.bound[e](r),v&&x(o,e)),t}):[],_.update(),v=!0,r(_.before_update),_.fragment=!!l&&l(_.ctx),i.target){if(i.hydrate){const e=function(e){return Array.from(e.childNodes)}(i.target);_.fragment&&_.fragment.l(e),e.forEach(c)}else _.fragment&&_.fragment.c();i.intro&&((b=o.$$.fragment)&&b.i&&(E.delete(b),b.i(y))),function(e,n,o){const{fragment:i,on_mount:a,on_destroy:c,after_update:l}=e.$$;i&&i.m(n,o),w(()=>{const n=a.map(t).filter(s);c?c.push(...n):r(n),e.$$.on_mount=[]}),l.forEach(w)}(o,i.target,i.anchor),I()}var b,y;d(p)}function T(e,t,n){return Array.from(function*(e,t,n){if(n=n||1,void 0===t&&(t=e>0?e:0,e=e<0?e:0),e!=t){e>t&&(n*=-1);for(let r=e;r<t;r+=n)yield r}}(e,t,n))}class O{_options={};constructor(){var e=location.search.substr(1).split("&"),t={};e.forEach(e=>{const[n,r]=e.split("=");t[n]=r}),console.info({options:t}),this._options=Object.assign({direction:"column",cellSize:"40px",cellGap:"5px",cells:420,channel:""},t)}getDirection(){return this._options.direction}getCellSize(){return this._options.cellSize}getCellGap(){return this._options.cellGap}getCells(){return+this._options.cells}getChannel(){return this._options.channel}}const R=[];function D(t,n=e){let r;const s=[];function i(e){if(o(t,e)&&(t=e,r)){const e=!R.length;for(let e=0;e<s.length;e+=1){const n=s[e];n[1](),R.push(n,t)}if(e){for(let e=0;e<R.length;e+=2)R[e][0](R[e+1]);R.length=0}}}return{set:i,update:function(e){i(e(t))},subscribe:function(o,a=e){const c=[o,a];return s.push(c),1===s.length&&(r=n(i)||e),o(t),()=>{const e=s.indexOf(c);-1!==e&&s.splice(e,1),0===s.length&&(r(),r=null)}}}}var $="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function P(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return j(null==t&&n.path)}},n.exports),n.exports}function j(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var A,L=Object.freeze({__proto__:null,default:{}}),M=P((function(e){var t=/^\u0001ACTION ([^\u0001]+)\u0001$/,n=/^(justinfan)(\d+$)/,r=/\\([sn:r\\])/g,s={s:" ",n:"",":":";",r:""},o=e.exports={get:(e,t)=>void 0===e?t:e,isBoolean:e=>"boolean"==typeof e,isFinite:e=>isFinite(e)&&!isNaN(parseFloat(e)),isInteger:e=>!isNaN(o.toNumber(e,0)),isJustinfan:e=>n.test(e),isNull:e=>null===e,isRegex:e=>/[\|\\\^\$\*\+\?\:\#]/.test(e),isString:e=>"string"==typeof e,isURL:e=>RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i").test(e),justinfan:()=>"justinfan"+Math.floor(8e4*Math.random()+1e3),password:e=>["SCHMOOPIIE","",null].includes(e)?"SCHMOOPIIE":"oauth:"+e.toLowerCase().replace("oauth:",""),promiseDelay:e=>new Promise((function(t){setTimeout(t,e)})),replaceAll:(e,t)=>{if(null==e)return null;for(var n in t)e=e.replace(new RegExp(n,"g"),t[n]);return e},unescapeHtml:e=>e.replace(/\\&amp\\;/g,"&").replace(/\\&lt\\;/g,"<").replace(/\\&gt\\;/g,">").replace(/\\&quot\\;/g,'"').replace(/\\&#039\\;/g,"'"),unescapeIRC:e=>e&&e.includes("\\")?e.replace(r,(e,t)=>t in s?s[t]:t):e,actionMessage:e=>e.match(t),addWord:(e,t)=>e.length?e+" "+t:e+t,channel:e=>{var t=(e||"").toLowerCase();return"#"===t[0]?t:"#"+t},extractNumber:e=>{for(var t=e.split(" "),n=0;n<t.length;n++)if(o.isInteger(t[n]))return~~t[n];return 0},formatDate:e=>{var t=e.getHours(),n=e.getMinutes();return`${t=(t<10?"0":"")+t}:${n=(n<10?"0":"")+n}`},inherits:(e,t)=>{e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},isNode:()=>{try{return"object"==typeof process&&"[object process]"===Object.prototype.toString.call(process)}catch(e){}return!1},isExtension:()=>{try{return window.chrome&&chrome.runtime&&chrome.runtime.id}catch(e){}return!1},isReactNative:()=>{try{return navigator&&"ReactNative"==navigator.product}catch(e){}return!1},merge:Object.assign,splitLine:(e,t)=>{var n=e.substring(0,t).lastIndexOf(" ");return-1===n&&(n=t-1),[e.substring(0,n),e.substring(n+1)]},toNumber:(e,t)=>{if(null===e)return 0;var n=Math.pow(10,o.isFinite(t)?t:0);return Math.round(e*n)/n},union:(e,t)=>{for(var n={},r=[],s=0;s<e.length;s++){n[o=e[s]]||(n[o]=!0,r.push(o))}for(s=0;s<t.length;s++){var o;n[o=t[s]]||(n[o]=!0,r.push(o))}return r},username:e=>{var t=(e||"").toLowerCase();return"#"===t[0]?t.slice(1):t}}})),B=(M.get,M.isBoolean,M.isInteger,M.isJustinfan,M.isNull,M.isRegex,M.isString,M.isURL,M.justinfan,M.password,M.promiseDelay,M.replaceAll,M.unescapeHtml,M.unescapeIRC,M.actionMessage,M.addWord,M.channel,M.extractNumber,M.formatDate,M.inherits,M.isNode,M.isExtension,M.isReactNative,M.merge,M.splitLine,M.toNumber,M.union,M.username,(A=L)&&A.default||A),U=function(e,t){var n=null===M.get(e.url,null)?M.get(e.uri,null):M.get(e.url,null);if(M.isURL(n)||(n="https://api.twitch.tv/kraken"+("/"===n[0]?n:"/"+n)),M.isNode())B(M.merge({method:"GET",json:!0},e,{url:n}),t);else if(M.isExtension()||M.isReactNative()){e=M.merge({url:n,method:"GET",headers:{}},e);var r=new XMLHttpRequest;for(var s in r.open(e.method,e.url,!0),e.headers)r.setRequestHeader(s,e.headers[s]);r.responseType="json",r.addEventListener("load",e=>{4==r.readyState&&(200!=r.status?t(r.status,null,null):t(null,null,r.response))}),r.send()}else{var o="jsonp_callback_"+Math.round(1e5*Math.random());window[o]=function(e){delete window[o],document.body.removeChild(i),t(null,null,e)};var i=document.createElement("script");i.src=`${n}${n.includes("?")?"&":"?"}callback=${o}`,document.body.appendChild(i)}};function F(e,t){return e=M.channel(e),t=M.get(t,30),this._sendCommand(this._getPromiseDelay(),e,"/followers "+t,(n,r)=>{this.once("_promiseFollowers",s=>{s?r(s):n([e,~~t])})})}function z(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/followersoff",(t,n)=>{this.once("_promiseFollowersoff",r=>{r?n(r):t([e])})})}function J(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),null,"PART "+e,(t,n)=>{this.once("_promisePart",r=>{r?n(r):t([e])})})}function W(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/r9kbeta",(t,n)=>{this.once("_promiseR9kbeta",r=>{r?n(r):t([e])})})}function q(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/r9kbetaoff",(t,n)=>{this.once("_promiseR9kbetaoff",r=>{r?n(r):t([e])})})}function H(e,t){return e=M.channel(e),t=M.get(t,300),this._sendCommand(this._getPromiseDelay(),e,"/slow "+t,(n,r)=>{this.once("_promiseSlow",s=>{s?r(s):n([e,~~t])})})}function G(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/slowoff",(t,n)=>{this.once("_promiseSlowoff",r=>{r?n(r):t([e])})})}var V={action:function(e,t){return e=M.channel(e),t=`ACTION ${t}`,this._sendMessage(this._getPromiseDelay(),e,t,(n,r)=>{n([e,t])})},ban:function(e,t,n){return e=M.channel(e),t=M.username(t),n=M.get(n,""),this._sendCommand(this._getPromiseDelay(),e,`/ban ${t} ${n}`,(r,s)=>{this.once("_promiseBan",o=>{o?s(o):r([e,t,n])})})},clear:function(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/clear",(t,n)=>{this.once("_promiseClear",r=>{r?n(r):t([e])})})},color:function(e,t){return t=M.get(t,e),this._sendCommand(this._getPromiseDelay(),"#tmijs","/color "+t,(e,n)=>{this.once("_promiseColor",r=>{r?n(r):e([t])})})},commercial:function(e,t){return e=M.channel(e),t=M.get(t,30),this._sendCommand(this._getPromiseDelay(),e,"/commercial "+t,(n,r)=>{this.once("_promiseCommercial",s=>{s?r(s):n([e,~~t])})})},deletemessage:function(e,t){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/delete "+t,(t,n)=>{this.once("_promiseDeletemessage",r=>{r?n(r):t([e])})})},emoteonly:function(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/emoteonly",(t,n)=>{this.once("_promiseEmoteonly",r=>{r?n(r):t([e])})})},emoteonlyoff:function(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/emoteonlyoff",(t,n)=>{this.once("_promiseEmoteonlyoff",r=>{r?n(r):t([e])})})},followersonly:F,followersmode:F,followersonlyoff:z,followersmodeoff:z,host:function(e,t){return e=M.channel(e),t=M.username(t),this._sendCommand(2e3,e,"/host "+t,(n,r)=>{this.once("_promiseHost",(s,o)=>{s?r(s):n([e,t,~~o])})})},join:function(e){return e=M.channel(e),this._sendCommand(null,null,"JOIN "+e,(t,n)=>{var r=!1,s=(o,i)=>{e===M.channel(i)&&(this.removeListener("_promiseJoin",s),r=!0,o?n(o):t([e]))};this.on("_promiseJoin",s);var o=this._getPromiseDelay();M.promiseDelay(o).then(()=>{r||this.emit("_promiseJoin","No response from Twitch.",e)})})},mod:function(e,t){return e=M.channel(e),t=M.username(t),this._sendCommand(this._getPromiseDelay(),e,"/mod "+t,(n,r)=>{this.once("_promiseMod",s=>{s?r(s):n([e,t])})})},mods:function(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/mods",(t,n)=>{this.once("_promiseMods",(r,s)=>{r?n(r):(s.forEach(t=>{this.moderators[e]||(this.moderators[e]=[]),this.moderators[e].includes(t)||this.moderators[e].push(t)}),t(s))})})},part:J,leave:J,ping:function(){return this._sendCommand(this._getPromiseDelay(),null,"PING",(e,t)=>{this.latency=new Date,this.pingTimeout=setTimeout(()=>{null!==this.ws&&(this.wasCloseCalled=!1,this.log.error("Ping timeout."),this.ws.close(),clearInterval(this.pingLoop),clearTimeout(this.pingTimeout))},M.get(this.opts.connection.timeout,9999)),this.once("_promisePing",t=>{e([parseFloat(t)])})})},r9kbeta:W,r9kmode:W,r9kbetaoff:q,r9kmodeoff:q,raw:function(e){return this._sendCommand(this._getPromiseDelay(),null,e,(t,n)=>{t([e])})},say:function(e,t){return e=M.channel(e),t.startsWith(".")&&!t.startsWith("..")||t.startsWith("/")||t.startsWith("\\")?"me "===t.substr(1,3)?this.action(e,t.substr(4)):this._sendCommand(this._getPromiseDelay(),e,t,(n,r)=>{n([e,t])}):this._sendMessage(this._getPromiseDelay(),e,t,(n,r)=>{n([e,t])})},slow:H,slowmode:H,slowoff:G,slowmodeoff:G,subscribers:function(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/subscribers",(t,n)=>{this.once("_promiseSubscribers",r=>{r?n(r):t([e])})})},subscribersoff:function(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/subscribersoff",(t,n)=>{this.once("_promiseSubscribersoff",r=>{r?n(r):t([e])})})},timeout:function(e,t,n,r){return e=M.channel(e),t=M.username(t),M.isNull(n)||M.isInteger(n)||(r=n,n=300),n=M.get(n,300),r=M.get(r,""),this._sendCommand(this._getPromiseDelay(),e,`/timeout ${t} ${n} ${r}`,(s,o)=>{this.once("_promiseTimeout",i=>{i?o(i):s([e,t,~~n,r])})})},unban:function(e,t){return e=M.channel(e),t=M.username(t),this._sendCommand(this._getPromiseDelay(),e,"/unban "+t,(n,r)=>{this.once("_promiseUnban",s=>{s?r(s):n([e,t])})})},unhost:function(e){return e=M.channel(e),this._sendCommand(2e3,e,"/unhost",(t,n)=>{this.once("_promiseUnhost",r=>{r?n(r):t([e])})})},unmod:function(e,t){return e=M.channel(e),t=M.username(t),this._sendCommand(this._getPromiseDelay(),e,"/unmod "+t,(n,r)=>{this.once("_promiseUnmod",s=>{s?r(s):n([e,t])})})},unvip:function(e,t){return e=M.channel(e),t=M.username(t),this._sendCommand(this._getPromiseDelay(),e,"/unvip "+t,(n,r)=>{this.once("_promiseUnvip",s=>{s?r(s):n([e,t])})})},vip:function(e,t){return e=M.channel(e),t=M.username(t),this._sendCommand(this._getPromiseDelay(),e,"/vip "+t,(n,r)=>{this.once("_promiseVip",s=>{s?r(s):n([e,t])})})},vips:function(e){return e=M.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/vips",(e,t)=>{this.once("_promiseVips",(n,r)=>{n?t(n):e(r)})})},whisper:function(e,t){return(e=M.username(e))===this.getUsername()?Promise.reject("Cannot send a whisper to the same account."):this._sendCommand(this._getPromiseDelay(),"#tmijs",`/w ${e} ${t}`,(n,r)=>{var s=M.channel(e),o=M.merge({"message-type":"whisper","message-id":null,"thread-id":null,username:this.getUsername()},this.globaluserstate);this.emits(["whisper","message"],[[s,o,t,!0],[s,o,t,!0]]),n([e,t])})}};function K(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t});var Q=K;function X(e){return"function"==typeof e}function Y(e){return"object"==typeof e&&null!==e}function Z(e){return void 0===e}K.EventEmitter=K,K.prototype._events=void 0,K.prototype._maxListeners=void 0,K.defaultMaxListeners=10,K.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},K.prototype.emits=function(e,t){for(var n=0;n<e.length;n++){var r=n<t.length?t[n]:t[t.length-1];this.emit.apply(this,[e[n]].concat(r))}},K.prototype.emit=function(e){var t,n,r,s,o,i;if(this._events||(this._events={}),"error"===e&&(!this._events.error||Y(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(Z(n=this._events[e]))return!1;if(X(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(Y(n))for(s=Array.prototype.slice.call(arguments,1),r=(i=n.slice()).length,o=0;o<r;o++)i[o].apply(this,s);return!0},K.prototype.addListener=function(e,t){var n;if(!X(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,X(t.listener)?t.listener:t),this._events[e]?Y(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,Y(this._events[e])&&!this._events[e].warned&&(n=Z(this._maxListeners)?K.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},K.prototype.on=K.prototype.addListener,K.prototype.once=function(e,t){if(!X(t))throw TypeError("listener must be a function");var n=!1;if(this._events.hasOwnProperty(e)&&"_"===e.charAt(0)){var r=1,s=e;for(var o in this._events)this._events.hasOwnProperty(o)&&o.startsWith(s)&&r++;e+=r}function i(){"_"!==e.charAt(0)||isNaN(e.substr(e.length-1))||(e=e.substring(0,e.length-1)),this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},K.prototype.removeListener=function(e,t){var n,r,s,o;if(!X(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=(n=this._events[e]).length,r=-1,n===t||X(n.listener)&&n.listener===t){if(delete this._events[e],this._events.hasOwnProperty(e+"2")&&"_"===e.charAt(0)){var i=e;for(var a in this._events)this._events.hasOwnProperty(a)&&a.startsWith(i)&&(isNaN(parseInt(a.substr(a.length-1)))||(this._events[e+parseInt(a.substr(a.length-1)-1)]=this._events[a],delete this._events[a]));this._events[e]=this._events[e+"1"],delete this._events[e+"1"]}this._events.removeListener&&this.emit("removeListener",e,t)}else if(Y(n)){for(o=s;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){r=o;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},K.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(X(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},K.prototype.listeners=function(e){return this._events&&this._events[e]?X(this._events[e])?[this._events[e]]:this._events[e].slice():[]},K.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(X(t))return 1;if(t)return t.length}return 0},K.listenerCount=function(e,t){return e.listenerCount(t)};var ee="info",te={trace:0,debug:1,info:2,warn:3,error:4,fatal:5};function ne(e){return function(t){te[e]>=te[ee]&&console.log(`[${M.formatDate(new Date)}] ${e}: ${t}`)}}var re={setLevel:function(e){ee=e},trace:ne("trace"),debug:ne("debug"),info:ne("info"),warn:ne("warn"),error:ne("error"),fatal:ne("fatal")},se=/\S+/g;function oe(e,t,n=",",r="/",s){var o=e[t];if(void 0===o)return e;var i=M.isString(o);if(e[t+"-raw"]=i?o:null,!0===o)return e[t]=null,e;if(e[t]={},i)for(var a=o.split(n),c=0;c<a.length;c++){var l=a[c].split(r),u=l[1];void 0!==s&&u&&(u=u.split(s)),e[t][l[0]]=u||null}return e}var ie=function(e){return oe(e,"badges")},ae=function(e){return oe(e,"badge-info")},ce=function(e){return oe(e,"emotes","/",":",",")},le=function(e,t,n,r){se.lastIndex=0;for(var s,o=new RegExp("(\\b|^|s)"+M.unescapeHtml(t)+"(\\b|$|s)");null!==(s=se.exec(e));)o.test(s[0])&&(r[n]=r[n]||[],r[n].push([s.index,se.lastIndex-1]))},ue=function(e,t,n,r){var s;for(se.lastIndex=0;null!==(s=se.exec(e));)s[0]===M.unescapeHtml(t)&&(r[n]=r[n]||[],r[n].push([s.index,se.lastIndex-1]))},he=function(e){var t="";return Object.keys(e).forEach(n=>{t=t+n+":",e[n].forEach(e=>{t=t+e.join("-")+","}),t=t.slice(0,-1)+"/"}),t.slice(0,-1)},fe=function(e){var t={raw:e,tags:{},prefix:null,command:null,params:[]},n=0,r=0;if(64===e.charCodeAt(0)){if(-1===(r=e.indexOf(" ")))return null;for(var s=e.slice(1,r).split(";"),o=0;o<s.length;o++){var i=s[o],a=i.split("=");t.tags[a[0]]=i.substring(i.indexOf("=")+1)||!0}n=r+1}for(;32===e.charCodeAt(n);)n++;if(58===e.charCodeAt(n)){if(-1===(r=e.indexOf(" ",n)))return null;for(t.prefix=e.slice(n+1,r),n=r+1;32===e.charCodeAt(n);)n++}if(-1===(r=e.indexOf(" ",n)))return e.length>n?(t.command=e.slice(n),t):null;for(t.command=e.slice(n,r),n=r+1;32===e.charCodeAt(n);)n++;for(;n<e.length;){if(r=e.indexOf(" ",n),58===e.charCodeAt(n)){t.params.push(e.slice(n+1));break}if(-1===r){if(-1===r){t.params.push(e.slice(n));break}}else for(t.params.push(e.slice(n,r)),n=r+1;32===e.charCodeAt(n);)n++}return t};function me(e){this.queue=[],this.index=0,this.defaultDelay=e||3e3}me.prototype.add=function(e,t){this.queue.push({fn:e,delay:t})},me.prototype.run=function(e){(e||0===e)&&(this.index=e),this.next()},me.prototype.next=function(){var e=this.index++,t=this.queue[e],n=this.queue[this.index];t&&(t.fn(),n&&setTimeout(()=>{this.next()},n.delay||this.defaultDelay))},me.prototype.reset=function(){this.index=0},me.prototype.clear=function(){this.index=0,this.queue=[]};var de={queue:me},pe=P((function(e){var t=Q.EventEmitter,n=$.WebSocket||$.MozWebSocket||B,r=function e(n){if(this instanceof e==!1)return new e(n);this.setMaxListeners(0),this.opts=M.get(n,{}),this.opts.channels=this.opts.channels||[],this.opts.connection=this.opts.connection||{},this.opts.identity=this.opts.identity||{},this.opts.options=this.opts.options||{},this.clientId=M.get(this.opts.options.clientId,null),this.maxReconnectAttempts=M.get(this.opts.connection.maxReconnectAttempts,1/0),this.maxReconnectInterval=M.get(this.opts.connection.maxReconnectInterval,3e4),this.reconnect=M.get(this.opts.connection.reconnect,!1),this.reconnectDecay=M.get(this.opts.connection.reconnectDecay,1.5),this.reconnectInterval=M.get(this.opts.connection.reconnectInterval,1e3),this.reconnecting=!1,this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.secure=M.get(this.opts.connection.secure,!1),this.emotes="",this.emotesets={},this.channels=[],this.currentLatency=0,this.globaluserstate={},this.lastJoined="",this.latency=new Date,this.moderators={},this.pingLoop=null,this.pingTimeout=null,this.reason="",this.username="",this.userstate={},this.wasCloseCalled=!1,this.ws=null;var r="error";this.opts.options.debug&&(r="info"),this.log=this.opts.logger||re;try{re.setLevel(r)}catch(e){}this.opts.channels.forEach((function(e,t,n){n[t]=M.channel(e)})),t.call(this)};for(var s in M.inherits(r,t),r.prototype.api=U,V)r.prototype[s]=V[s];r.prototype.handleMessage=function(e){if(!M.isNull(e)){this.emit("raw_message",JSON.parse(JSON.stringify(e)),e);var t=M.channel(M.get(e.params[0],null)),n=M.get(e.params[1],null),r=M.get(e.tags["msg-id"],null);if(e.tags=ie(ae(ce(e.tags))),e.tags){var s=e.tags;for(var o in s)if("emote-sets"!==o&&"ban-duration"!==o&&"bits"!==o){var i=s[o];M.isBoolean(i)?i=null:"1"===i?i=!0:"0"===i?i=!1:M.isString(i)&&(i=M.unescapeIRC(i)),s[o]=i}}if(M.isNull(e.prefix))switch(e.command){case"PING":this.emit("ping"),M.isNull(this.ws)||1!==this.ws.readyState||this.ws.send("PONG");break;case"PONG":var a=new Date;this.currentLatency=(a.getTime()-this.latency.getTime())/1e3,this.emits(["pong","_promisePing"],[[this.currentLatency]]),clearTimeout(this.pingTimeout);break;default:this.log.warn("Could not parse message with no prefix:\n"+JSON.stringify(e,null,4))}else if("tmi.twitch.tv"===e.prefix)switch(e.command){case"002":case"003":case"004":case"375":case"376":case"CAP":break;case"001":this.username=e.params[0];break;case"372":this.log.info("Connected to server."),this.userstate["#tmijs"]={},this.emits(["connected","_promiseConnect"],[[this.server,this.port],[null]]),this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.pingLoop=setInterval(()=>{M.isNull(this.ws)||1!==this.ws.readyState||this.ws.send("PING"),this.latency=new Date,this.pingTimeout=setTimeout(()=>{M.isNull(this.ws)||(this.wasCloseCalled=!1,this.log.error("Ping timeout."),this.ws.close(),clearInterval(this.pingLoop),clearTimeout(this.pingTimeout))},M.get(this.opts.connection.timeout,9999))},6e4);var c=new de.queue(2e3),l=M.union(this.opts.channels,this.channels);this.channels=[];for(var u=0;u<l.length;u++){let e=l[u];c.add(()=>{M.isNull(this.ws)||1!==this.ws.readyState||this.join(e).catch(e=>{this.log.error(e)})})}c.run();break;case"NOTICE":var h=[null],f=[t,r,n],m=[t,!0],d=[t,!1],p=[f,h],g=[f,[r]],_=`[${t}] ${n}`;switch(r){case"subs_on":this.log.info(`[${t}] This room is now in subscribers-only mode.`),this.emits(["subscriber","subscribers","_promiseSubscribers"],[m,m,h]);break;case"subs_off":this.log.info(`[${t}] This room is no longer in subscribers-only mode.`),this.emits(["subscriber","subscribers","_promiseSubscribersoff"],[d,d,h]);break;case"emote_only_on":this.log.info(`[${t}] This room is now in emote-only mode.`),this.emits(["emoteonly","_promiseEmoteonly"],[m,h]);break;case"emote_only_off":this.log.info(`[${t}] This room is no longer in emote-only mode.`),this.emits(["emoteonly","_promiseEmoteonlyoff"],[d,h]);break;case"slow_on":case"slow_off":break;case"followers_on_zero":case"followers_on":case"followers_off":break;case"r9k_on":this.log.info(`[${t}] This room is now in r9k mode.`),this.emits(["r9kmode","r9kbeta","_promiseR9kbeta"],[m,m,h]);break;case"r9k_off":this.log.info(`[${t}] This room is no longer in r9k mode.`),this.emits(["r9kmode","r9kbeta","_promiseR9kbetaoff"],[d,d,h]);break;case"room_mods":var v=n.split(": ")[1].toLowerCase().split(", ").filter(e=>e);this.emits(["_promiseMods","mods"],[[null,v],[t,v]]);break;case"no_mods":this.emits(["_promiseMods","mods"],[[null,[]],[t,[]]]);break;case"vips_success":n.endsWith(".")&&(n=n.slice(0,-1));var b=n.split(": ")[1].toLowerCase().split(", ").filter(e=>e);this.emits(["_promiseVips","vips"],[[null,b],[t,b]]);break;case"no_vips":this.emits(["_promiseVips","vips"],[[null,[]],[t,[]]]);break;case"already_banned":case"bad_ban_admin":case"bad_ban_broadcaster":case"bad_ban_global_mod":case"bad_ban_self":case"bad_ban_staff":case"usage_ban":this.log.info(_),this.emits(["notice","_promiseBan"],g);break;case"ban_success":this.log.info(_),this.emits(["notice","_promiseBan"],p);break;case"usage_clear":this.log.info(_),this.emits(["notice","_promiseClear"],g);break;case"usage_mods":this.log.info(_),this.emits(["notice","_promiseMods"],[f,[r,[]]]);break;case"mod_success":this.log.info(_),this.emits(["notice","_promiseMod"],p);break;case"usage_vips":this.log.info(_),this.emits(["notice","_promiseVips"],[f,[r,[]]]);break;case"usage_vip":case"bad_vip_grantee_banned":case"bad_vip_grantee_already_vip":this.log.info(_),this.emits(["notice","_promiseVip"],[f,[r,[]]]);break;case"vip_success":this.log.info(_),this.emits(["notice","_promiseVip"],p);break;case"usage_mod":case"bad_mod_banned":case"bad_mod_mod":this.log.info(_),this.emits(["notice","_promiseMod"],g);break;case"unmod_success":this.log.info(_),this.emits(["notice","_promiseUnmod"],p);break;case"unvip_success":this.log.info(_),this.emits(["notice","_promiseUnvip"],p);break;case"usage_unmod":case"bad_unmod_mod":this.log.info(_),this.emits(["notice","_promiseUnmod"],g);break;case"usage_unvip":case"bad_unvip_grantee_not_vip":this.log.info(_),this.emits(["notice","_promiseUnvip"],g);break;case"color_changed":this.log.info(_),this.emits(["notice","_promiseColor"],p);break;case"usage_color":case"turbo_only_color":this.log.info(_),this.emits(["notice","_promiseColor"],g);break;case"commercial_success":this.log.info(_),this.emits(["notice","_promiseCommercial"],p);break;case"usage_commercial":case"bad_commercial_error":this.log.info(_),this.emits(["notice","_promiseCommercial"],g);break;case"hosts_remaining":this.log.info(_);var y=isNaN(n[0])?0:parseInt(n[0]);this.emits(["notice","_promiseHost"],[f,[null,~~y]]);break;case"bad_host_hosting":case"bad_host_rate_exceeded":case"bad_host_error":case"usage_host":this.log.info(_),this.emits(["notice","_promiseHost"],[f,[r,null]]);break;case"already_r9k_on":case"usage_r9k_on":this.log.info(_),this.emits(["notice","_promiseR9kbeta"],g);break;case"already_r9k_off":case"usage_r9k_off":this.log.info(_),this.emits(["notice","_promiseR9kbetaoff"],g);break;case"timeout_success":this.log.info(_),this.emits(["notice","_promiseTimeout"],p);break;case"delete_message_success":this.log.info(`[${t} ${n}]`),this.emits(["notice","_promiseDeletemessage"],p);case"already_subs_off":case"usage_subs_off":this.log.info(_),this.emits(["notice","_promiseSubscribersoff"],g);break;case"already_subs_on":case"usage_subs_on":this.log.info(_),this.emits(["notice","_promiseSubscribers"],g);break;case"already_emote_only_off":case"usage_emote_only_off":this.log.info(_),this.emits(["notice","_promiseEmoteonlyoff"],g);break;case"already_emote_only_on":case"usage_emote_only_on":this.log.info(_),this.emits(["notice","_promiseEmoteonly"],g);break;case"usage_slow_on":this.log.info(_),this.emits(["notice","_promiseSlow"],g);break;case"usage_slow_off":this.log.info(_),this.emits(["notice","_promiseSlowoff"],g);break;case"usage_timeout":case"bad_timeout_admin":case"bad_timeout_broadcaster":case"bad_timeout_duration":case"bad_timeout_global_mod":case"bad_timeout_self":case"bad_timeout_staff":this.log.info(_),this.emits(["notice","_promiseTimeout"],g);break;case"untimeout_success":case"unban_success":this.log.info(_),this.emits(["notice","_promiseUnban"],p);break;case"usage_unban":case"bad_unban_no_ban":this.log.info(_),this.emits(["notice","_promiseUnban"],g);break;case"usage_delete":case"bad_delete_message_error":case"bad_delete_message_broadcaster":case"bad_delete_message_mod":this.log.info(_),this.emits(["notice","_promiseDeletemessage"],g);break;case"usage_unhost":case"not_hosting":this.log.info(_),this.emits(["notice","_promiseUnhost"],g);break;case"whisper_invalid_login":case"whisper_invalid_self":case"whisper_limit_per_min":case"whisper_limit_per_sec":case"whisper_restricted_recipient":this.log.info(_),this.emits(["notice","_promiseWhisper"],g);break;case"no_permission":case"msg_banned":case"msg_room_not_found":case"msg_channel_suspended":case"tos_ban":this.log.info(_),this.emits(["notice","_promiseBan","_promiseClear","_promiseUnban","_promiseTimeout","_promiseDeletemessage","_promiseMods","_promiseMod","_promiseUnmod","_promiseVips","_promiseVip","_promiseUnvip","_promiseCommercial","_promiseHost","_promiseUnhost","_promiseJoin","_promisePart","_promiseR9kbeta","_promiseR9kbetaoff","_promiseSlow","_promiseSlowoff","_promiseFollowers","_promiseFollowersoff","_promiseSubscribers","_promiseSubscribersoff","_promiseEmoteonly","_promiseEmoteonlyoff"],[f,[r,t]]);break;case"msg_rejected":case"msg_rejected_mandatory":this.log.info(_),this.emit("automod",t,r,n);break;case"unrecognized_cmd":this.log.info(_),this.emit("notice",t,r,n);break;case"cmds_available":case"host_target_went_offline":case"msg_censored_broadcaster":case"msg_duplicate":case"msg_emoteonly":case"msg_verified_email":case"msg_ratelimit":case"msg_subsonly":case"msg_timedout":case"msg_bad_characters":case"msg_channel_blocked":case"msg_facebook":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_slowmode":case"msg_suspended":case"no_help":case"usage_disconnect":case"usage_help":case"usage_me":this.log.info(_),this.emit("notice",t,r,n);break;case"host_on":case"host_off":break;default:n.includes("Login unsuccessful")||n.includes("Login authentication failed")||n.includes("Error logging in")||n.includes("Improperly formatted auth")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason=n,this.log.error(this.reason),this.ws.close()):n.includes("Invalid NICK")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason="Invalid NICK.",this.log.error(this.reason),this.ws.close()):this.log.warn("Could not parse NOTICE from tmi.twitch.tv:\n"+JSON.stringify(e,null,4))}break;case"USERNOTICE":var w=e.tags["display-name"]||e.tags.login,C=e.tags["msg-param-sub-plan"]||"",S=M.unescapeIRC(M.get(e.tags["msg-param-sub-plan-name"],""))||null,I={prime:C.includes("Prime"),plan:C,planName:S},k=e.tags,E=~~(e.tags["msg-param-streak-months"]||0),x=e.tags["msg-param-recipient-display-name"]||e.tags["msg-param-recipient-user-name"],N=~~e.tags["msg-param-mass-gift-count"];switch(k["message-type"]=r,r){case"resub":this.emits(["resub","subanniversary"],[[t,w,E,n,k,I]]);break;case"sub":this.emit("subscription",t,w,I,n,k);break;case"subgift":this.emit("subgift",t,w,E,x,I,k);break;case"anonsubgift":this.emit("anonsubgift",t,E,x,I,k);break;case"submysterygift":this.emit("submysterygift",t,w,N,I,k);break;case"anonsubmysterygift":this.emit("anonsubmysterygift",t,N,I,k);break;case"primepaidupgrade":this.emit("primepaidupgrade",t,w,I,k);break;case"giftpaidupgrade":var T=e.tags["msg-param-sender-name"]||e.tags["msg-param-sender-login"];this.emit("giftpaidupgrade",t,w,T,k);break;case"anongiftpaidupgrade":this.emit("anongiftpaidupgrade",t,w,k);break;case"raid":w=e.tags["msg-param-displayName"]||e.tags["msg-param-login"];var O=e.tags["msg-param-viewerCount"];this.emit("raided",t,w,O)}break;case"HOSTTARGET":var R=n.split(" ");O=~~R[1]||0;"-"===R[0]?(this.log.info(`[${t}] Exited host mode.`),this.emits(["unhost","_promiseUnhost"],[[t,O],[null]])):(this.log.info(`[${t}] Now hosting ${R[0]} for ${O} viewer(s).`),this.emit("hosting",t,R[0],O));break;case"CLEARCHAT":if(e.params.length>1){var D=M.get(e.tags["ban-duration"],null);M.isNull(D)?(this.log.info(`[${t}] ${n} has been banned.`),this.emit("ban",t,n,null,e.tags)):(this.log.info(`[${t}] ${n} has been timed out for ${D} seconds.`),this.emit("timeout",t,n,null,~~D,e.tags))}else this.log.info(`[${t}] Chat was cleared by a moderator.`),this.emits(["clearchat","_promiseClear"],[[t],[null]]);break;case"CLEARMSG":if(e.params.length>1){w=e.tags.login;var $=n;(k=e.tags)["message-type"]="messagedeleted",this.log.info(`[${t}] ${w}'s message has been deleted.`),this.emit("messagedeleted",t,w,$,k)}break;case"RECONNECT":this.log.info("Received RECONNECT request from Twitch.."),this.log.info(`Disconnecting and reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.disconnect(),setTimeout(()=>{this.connect()},this.reconnectTimer);break;case"USERSTATE":e.tags.username=this.username,"mod"===e.tags["user-type"]&&(this.moderators[this.lastJoined]||(this.moderators[this.lastJoined]=[]),this.moderators[this.lastJoined].includes(this.username)||this.moderators[this.lastJoined].push(this.username)),M.isJustinfan(this.getUsername())||this.userstate[t]||(this.userstate[t]=e.tags,this.lastJoined=t,this.channels.push(t),this.log.info("Joined "+t),this.emit("join",t,M.username(this.getUsername()),!0)),e.tags["emote-sets"]!==this.emotes&&this._updateEmoteset(e.tags["emote-sets"]),this.userstate[t]=e.tags;break;case"GLOBALUSERSTATE":this.globaluserstate=e.tags,void 0!==e.tags["emote-sets"]&&this._updateEmoteset(e.tags["emote-sets"]);break;case"ROOMSTATE":if(M.channel(this.lastJoined)===t&&this.emit("_promiseJoin",null,t),e.tags.channel=t,this.emit("roomstate",t,e.tags),!e.tags.hasOwnProperty("subs-only")){if(e.tags.hasOwnProperty("slow"))if("boolean"!=typeof e.tags.slow||e.tags.slow){var P=[t,!0,~~e.tags.slow];this.log.info(`[${t}] This room is now in slow mode.`),this.emits(["slow","slowmode","_promiseSlow"],[P,P,[null]])}else{var j=[t,!1,0];this.log.info(`[${t}] This room is no longer in slow mode.`),this.emits(["slow","slowmode","_promiseSlowoff"],[j,j,[null]])}if(e.tags.hasOwnProperty("followers-only"))if("-1"===e.tags["followers-only"]){j=[t,!1,0];this.log.info(`[${t}] This room is no longer in followers-only mode.`),this.emits(["followersonly","followersmode","_promiseFollowersoff"],[j,j,[null]])}else{P=[t,!0,~~e.tags["followers-only"]];this.log.info(`[${t}] This room is now in follower-only mode.`),this.emits(["followersonly","followersmode","_promiseFollowers"],[P,P,[null]])}}break;case"SERVERCHANGE":break;default:this.log.warn("Could not parse message from tmi.twitch.tv:\n"+JSON.stringify(e,null,4))}else if("jtv"===e.prefix)switch(e.command){case"MODE":"+o"===n?(this.moderators[t]||(this.moderators[t]=[]),this.moderators[t].includes(e.params[2])||this.moderators[t].push(e.params[2]),this.emit("mod",t,e.params[2])):"-o"===n&&(this.moderators[t]||(this.moderators[t]=[]),this.moderators[t].filter(t=>t!=e.params[2]),this.emit("unmod",t,e.params[2]));break;default:this.log.warn("Could not parse message from jtv:\n"+JSON.stringify(e,null,4))}else switch(e.command){case"353":this.emit("names",e.params[2],e.params[3].split(" "));break;case"366":break;case"JOIN":var A=e.prefix.split("!")[0];M.isJustinfan(this.getUsername())&&this.username===A&&(this.lastJoined=t,this.channels.push(t),this.log.info("Joined "+t),this.emit("join",t,A,!0)),this.username!==A&&this.emit("join",t,A,!1);break;case"PART":var L,B=!1;A=e.prefix.split("!")[0];if(this.username===A)B=!0,this.userstate[t]&&delete this.userstate[t],-1!==(L=this.channels.indexOf(t))&&this.channels.splice(L,1),-1!==(L=this.opts.channels.indexOf(t))&&this.opts.channels.splice(L,1),this.log.info("Left "+t),this.emit("_promisePart",null);this.emit("part",t,A,B);break;case"WHISPER":A=e.prefix.split("!")[0];this.log.info(`[WHISPER] <${A}>: ${n}`),e.tags.hasOwnProperty("username")||(e.tags.username=A),e.tags["message-type"]="whisper";var U=M.channel(e.tags.username);this.emits(["whisper","message"],[[U,e.tags,n,!1]]);break;case"PRIVMSG":if(e.tags.username=e.prefix.split("!")[0],"jtv"===e.tags.username){var F=M.username(n.split(" ")[0]),z=n.includes("auto");if(n.includes("hosting you for")){var J=M.extractNumber(n);this.emit("hosted",t,F,J,z)}else n.includes("hosting you")&&this.emit("hosted",t,F,0,z)}else{var W=M.actionMessage(n);W?(e.tags["message-type"]="action",this.log.info(`[${t}] *<${e.tags.username}>: ${W[1]}`),this.emits(["action","message"],[[t,e.tags,W[1],!1]])):e.tags.hasOwnProperty("bits")?this.emit("cheer",t,e.tags,n):(e.tags["message-type"]="chat",this.log.info(`[${t}] <${e.tags.username}>: ${n}`),this.emits(["chat","message"],[[t,e.tags,n,!1]]))}break;default:this.log.warn("Could not parse message:\n"+JSON.stringify(e,null,4))}}},r.prototype.connect=function(){return new Promise((e,t)=>{this.server=M.get(this.opts.connection.server,"irc-ws.chat.twitch.tv"),this.port=M.get(this.opts.connection.port,80),this.secure&&(this.port=443),443===this.port&&(this.secure=!0),this.reconnectTimer=this.reconnectTimer*this.reconnectDecay,this.reconnectTimer>=this.maxReconnectInterval&&(this.reconnectTimer=this.maxReconnectInterval),this._openConnection(),this.once("_promiseConnect",n=>{n?t(n):e([this.server,~~this.port])})})},r.prototype._openConnection=function(){this.ws=new n(`${this.secure?"wss":"ws"}://${this.server}:${this.port}/`,"irc"),this.ws.onmessage=this._onMessage.bind(this),this.ws.onerror=this._onError.bind(this),this.ws.onclose=this._onClose.bind(this),this.ws.onopen=this._onOpen.bind(this)},r.prototype._onOpen=function(){M.isNull(this.ws)||1!==this.ws.readyState||(this.log.info(`Connecting to ${this.server} on port ${this.port}..`),this.emit("connecting",this.server,~~this.port),this.username=M.get(this.opts.identity.username,M.justinfan()),this.password=M.password(M.get(this.opts.identity.password,"SCHMOOPIIE")),this.log.info("Sending authentication to server.."),this.emit("logon"),this.ws.send("CAP REQ :twitch.tv/tags twitch.tv/commands twitch.tv/membership"),this.ws.send("PASS "+this.password),this.ws.send("NICK "+this.username))},r.prototype._onMessage=function(e){e.data.split("\r\n").forEach(e=>{M.isNull(e)||this.handleMessage(fe(e))})},r.prototype._onError=function(){this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),this.reason=M.isNull(this.ws)?"Connection closed.":"Unable to connect.",this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error(`Reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.emit("reconnect"),setTimeout(()=>{this.reconnecting=!1,this.connect()},this.reconnectTimer)),this.ws=null},r.prototype._onClose=function(){this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),this.wasCloseCalled?(this.wasCloseCalled=!1,this.reason="Connection closed.",this.log.info(this.reason),this.emits(["_promiseConnect","_promiseDisconnect","disconnected"],[[this.reason],[null],[this.reason]])):(this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error(`Could not connect to server. Reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.emit("reconnect"),setTimeout(()=>{this.reconnecting=!1,this.connect()},this.reconnectTimer))),this.ws=null},r.prototype._getPromiseDelay=function(){return this.currentLatency<=600?600:this.currentLatency+100},r.prototype._sendCommand=function(e,t,n,r){return new Promise((s,o)=>{if(M.isNull(this.ws)||1!==this.ws.readyState)return o("Not connected to server.");if("number"==typeof e&&M.promiseDelay(e).then(()=>{o("No response from Twitch.")}),M.isNull(t))this.log.info("Executing command: "+n),this.ws.send(n);else{var i=M.channel(t);this.log.info(`[${i}] Executing command: ${n}`),this.ws.send(`PRIVMSG ${i} :${n}`)}r(s,o)})},r.prototype._sendMessage=function(e,t,n,r){return new Promise((s,o)=>{if(M.isNull(this.ws)||1!==this.ws.readyState)return o("Not connected to server.");if(M.isJustinfan(this.getUsername()))return o("Cannot send anonymous messages.");var i=M.channel(t);if(this.userstate[i]||(this.userstate[i]={}),n.length>=500){var a=M.splitLine(n,500);n=a[0],setTimeout(()=>{this._sendMessage(e,t,a[1],()=>{})},350)}this.ws.send(`PRIVMSG ${i} :${n}`);var c={};Object.keys(this.emotesets).forEach(e=>{this.emotesets[e].forEach((function(e){if(M.isRegex(e.code))return le(n,e.code,e.id,c);ue(n,e.code,e.id,c)}))});var l=M.merge(this.userstate[i],ce({emotes:he(c)||null})),u=M.actionMessage(n);u?(l["message-type"]="action",this.log.info(`[${i}] *<${this.getUsername()}>: ${u[1]}`),this.emits(["action","message"],[[i,l,u[1],!0]])):(l["message-type"]="chat",this.log.info(`[${i}] <${this.getUsername()}>: ${n}`),this.emits(["chat","message"],[[i,l,n,!0]])),r(s,o)})},r.prototype._updateEmoteset=function(e){this.emotes=e,this.api({url:"/chat/emoticon_images?emotesets="+e,headers:{Authorization:"OAuth "+M.password(M.get(this.opts.identity.password,"")).replace("oauth:",""),"Client-ID":this.clientId}},(t,n,r)=>{if(!t)return this.emotesets=r.emoticon_sets||{},this.emit("emotesets",e,this.emotesets);setTimeout(()=>{this._updateEmoteset(e)},6e4)})},r.prototype.getUsername=function(){return this.username},r.prototype.getOptions=function(){return this.opts},r.prototype.getChannels=function(){return this.channels},r.prototype.isMod=function(e,t){var n=M.channel(e);return this.moderators[n]||(this.moderators[n]=[]),this.moderators[n].includes(M.username(t))},r.prototype.readyState=function(){return M.isNull(this.ws)?"CLOSED":["CONNECTING","OPEN","CLOSING","CLOSED"][this.ws.readyState]},r.prototype.disconnect=function(){return new Promise((e,t)=>{M.isNull(this.ws)||3===this.ws.readyState?(this.log.error("Cannot disconnect from server. Socket is not opened or connection is already closing."),t("Cannot disconnect from server. Socket is not opened or connection is already closing.")):(this.wasCloseCalled=!0,this.log.info("Disconnecting from server.."),this.ws.close(),this.once("_promiseDisconnect",()=>{e([this.server,~~this.port])}))})},e.exports&&(e.exports=r),"undefined"!=typeof window&&(window.tmi={},window.tmi.client=r,window.tmi.Client=r)})),ge={client:pe,Client:pe}.Client;class _e{parseCommand(e,t,n){if(!e.startsWith("!pixel"))return null;const r={action:"",value:"",badges:n.badges,username:t};if(e.includes("=")&&e.includes(":")){const[t,n]=e.split("="),[s,o]=t.split(":");r.action=o,r.value=n}else{const t=e.replace("!pixel","").trim(),[n,s]=t.split(" ");console.info({commandWithoutPrefix:t,action:n,value:s}),r.action=n,r.value=s}if("add"===r.action&&("me"===r.value&&(r.value=n.color),n.emotes)){const e=Object.keys(n.emotes);e.length>0&&(r.value={color:r.value,emote:e[0]})}return r}}class ve{commandReceived$=D(null);_channelName="";_commandValidator=new _e;constructor(e){this._channelName=e;const t=new ge({connection:{secure:!0,reconnect:!0},channels:[e]});console.info({channelName:e}),t.connect(),t.on("message",(e,t,n,r)=>{const s=t.username;console.info({channel:e,tags:t,message:n,self:r});const o=this._commandValidator.parseCommand(n,s,t);this.commandReceived$.set(o)})}}var be=P((function(e,t){
/*!
        localForage -- Offline Storage, Improved
        Version 1.7.4
        https://localforage.github.io/localForage
        (c) 2013-2017 Mozilla, Apache License 2.0
    */
e.exports=function e(t,n,r){function s(i,a){if(!n[i]){if(!t[i]){if(!a&&j)return j();if(o)return o(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[i]={exports:{}};t[i][0].call(l.exports,(function(e){var n=t[i][1][e];return s(n||e)}),l,l.exports,e,t,n,r)}return n[i].exports}for(var o=j,i=0;i<r.length;i++)s(r[i]);return s}({1:[function(e,t,n){(function(e){var n,r,s=e.MutationObserver||e.WebKitMutationObserver;if(s){var o=0,i=new s(u),a=e.document.createTextNode("");i.observe(a,{characterData:!0}),n=function(){a.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var c=new e.MessageChannel;c.port1.onmessage=u,n=function(){c.port2.postMessage(0)}}var l=[];function u(){var e,t;r=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}r=!1}t.exports=function(e){1!==l.push(e)||r||n()}}).call(this,void 0!==$?$:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){var r=e(1);function s(){}var o={},i=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==s&&m(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function h(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return o.reject(e,t)}r===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,r)}))}function f(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function m(e,t){var n=!1;function r(t){n||(n=!0,o.reject(e,t))}function s(t){n||(n=!0,o.resolve(e,t))}var i=d((function(){t(s,r)}));"error"===i.status&&r(i.value)}function d(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}t.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===i)return this;var n=new this.constructor(s);return this.state!==c?h(n,this.state===a?e:t,this.outcome):this.queue.push(new u(n,e,t)),n},u.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){h(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){o.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){h(this.promise,this.onRejected,e)},o.resolve=function(e,t){var n=d(f,t);if("error"===n.status)return o.reject(e,n.value);var r=n.value;if(r)m(e,r);else{e.state=a,e.outcome=t;for(var s=-1,i=e.queue.length;++s<i;)e.queue[s].callFulfilled(t)}return e},o.reject=function(e,t){e.state=i,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},l.resolve=function(e){return e instanceof this?e:o.resolve(new this(s),e)},l.reject=function(e){var t=new this(s);return o.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var i=new Array(n),a=0,c=-1,l=new this(s);++c<n;)u(e[c],c);return l;function u(e,s){t.resolve(e).then((function(e){i[s]=e,++a!==n||r||(r=!0,o.resolve(l,i))}),(function(e){r||(r=!0,o.reject(l,e))}))}},l.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var i,a=-1,c=new this(s);++a<n;)i=e[a],t.resolve(i).then((function(e){r||(r=!0,o.resolve(c,e))}),(function(e){r||(r=!0,o.reject(c,e))}));return c}},{1:1}],3:[function(e,t,n){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==$?$:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function o(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(s){if("TypeError"!==s.name)throw s;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var i=Promise;function a(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function c(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function l(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function u(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var h=void 0,f={},m=Object.prototype.toString;function d(e){return"boolean"==typeof h?i.resolve(h):function(e){return new i((function(t){var n=e.transaction("local-forage-detect-blob-support","readwrite"),r=o([""]);n.objectStore("local-forage-detect-blob-support").put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return h=e}))}function p(e){var t=f[e.name],n={};n.promise=new i((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function g(e){var t=f[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function _(e,t){var n=f[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function v(e,t){return new i((function(n,r){if(f[e.name]=f[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);p(e),e.db.close()}var o=[e.name];t&&o.push(e.version);var i=s.open.apply(s,o);t&&(i.onupgradeneeded=function(t){var n=i.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore("local-forage-detect-blob-support")}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),i.onerror=function(e){e.preventDefault(),r(i.error)},i.onsuccess=function(){n(i.result),g(e)}}))}function b(e){return v(e,!1)}function y(e){return v(e,!0)}function w(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,s=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),s||n){if(n){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function C(e){return o([function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),s=0;s<t;s++)r[s]=e.charCodeAt(s);return n}(atob(e.data))],{type:e.type})}function S(e){return e&&e.__local_forage_encoded_blob}function I(e){var t=this,n=t._initReady().then((function(){var e=f[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return c(n,e,e),n}function k(e,t,n,r){void 0===r&&(r=1);try{var s=e.db.transaction(e.storeName,t);n(null,s)}catch(s){if(r>0&&(!e.db||"InvalidStateError"===s.name||"NotFoundError"===s.name))return i.resolve().then((function(){if(!e.db||"NotFoundError"===s.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),y(e)})).then((function(){return function(e){p(e);for(var t=f[e.name],n=t.forages,r=0;r<n.length;r++){var s=n[r];s._dbInfo.db&&(s._dbInfo.db.close(),s._dbInfo.db=null)}return e.db=null,b(e).then((function(t){return e.db=t,w(e)?y(e):t})).then((function(r){e.db=t.db=r;for(var s=0;s<n.length;s++)n[s]._dbInfo.db=r})).catch((function(t){throw _(e,t),t}))}(e).then((function(){k(e,t,n,r-1)}))})).catch(n);n(s)}}var E={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var s=f[n.name];s||(s={forages:[],db:null,dbReady:null,deferredOperations:[]},f[n.name]=s),s.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=I);var o=[];function a(){return i.resolve()}for(var c=0;c<s.forages.length;c++){var l=s.forages[c];l!==t&&o.push(l._initReady().catch(a))}var u=s.forages.slice(0);return i.all(o).then((function(){return n.db=s.db,b(n)})).then((function(e){return n.db=e,w(n,t._defaultConfig.version)?y(n):e})).then((function(e){n.db=s.db=e,t._dbInfo=n;for(var r=0;r<u.length;r++){var o=u[r];o!==t&&(o._dbInfo.db=n.db,o._dbInfo.version=n.version)}}))},_support:function(){try{if(!s||!s.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=new i((function(t,r){n.ready().then((function(){k(n._dbInfo,"readonly",(function(s,o){if(s)return r(s);try{var i=o.objectStore(n._dbInfo.storeName).openCursor(),a=1;i.onsuccess=function(){var n=i.result;if(n){var r=n.value;S(r)&&(r=C(r));var s=e(r,n.key,a++);void 0!==s?t(s):n.continue()}else t()},i.onerror=function(){r(i.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=new i((function(t,r){n.ready().then((function(){k(n._dbInfo,"readonly",(function(s,o){if(s)return r(s);try{var i=o.objectStore(n._dbInfo.storeName).get(e);i.onsuccess=function(){var e=i.result;void 0===e&&(e=null),S(e)&&(e=C(e)),t(e)},i.onerror=function(){r(i.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,t),r},setItem:function(e,t,n){var r=this;e=l(e);var s=new i((function(n,s){var o;r.ready().then((function(){return o=r._dbInfo,"[object Blob]"===m.call(t)?d(o.db).then((function(e){return e?t:(n=t,new i((function(e,t){var r=new FileReader;r.onerror=t,r.onloadend=function(t){var r=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:n.type})},r.readAsBinaryString(n)})));var n})):t})).then((function(t){k(r._dbInfo,"readwrite",(function(o,i){if(o)return s(o);try{var a=i.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);i.oncomplete=function(){void 0===t&&(t=null),n(t)},i.onabort=i.onerror=function(){var e=c.error?c.error:c.transaction.error;s(e)}}catch(e){s(e)}}))})).catch(s)}));return a(s,n),s},removeItem:function(e,t){var n=this;e=l(e);var r=new i((function(t,r){n.ready().then((function(){k(n._dbInfo,"readwrite",(function(s,o){if(s)return r(s);try{var i=o.objectStore(n._dbInfo.storeName).delete(e);o.oncomplete=function(){t()},o.onerror=function(){r(i.error)},o.onabort=function(){var e=i.error?i.error:i.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return a(r,t),r},clear:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){k(t._dbInfo,"readwrite",(function(r,s){if(r)return n(r);try{var o=s.objectStore(t._dbInfo.storeName).clear();s.oncomplete=function(){e()},s.onabort=s.onerror=function(){var e=o.error?o.error:o.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return a(n,e),n},length:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){k(t._dbInfo,"readonly",(function(r,s){if(r)return n(r);try{var o=s.objectStore(t._dbInfo.storeName).count();o.onsuccess=function(){e(o.result)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return a(n,e),n},key:function(e,t){var n=this,r=new i((function(t,r){e<0?t(null):n.ready().then((function(){k(n._dbInfo,"readonly",(function(s,o){if(s)return r(s);try{var i=o.objectStore(n._dbInfo.storeName),a=!1,c=i.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||a?t(n.key):(a=!0,n.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,t),r},keys:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){k(t._dbInfo,"readonly",(function(r,s){if(r)return n(r);try{var o=s.objectStore(t._dbInfo.storeName).openKeyCursor(),i=[];o.onsuccess=function(){var t=o.result;t?(i.push(t.key),t.continue()):e(i)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return a(n,e),n},dropInstance:function(e,t){t=u.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,o=this;if(e.name){var c=e.name===n.name&&o._dbInfo.db,l=c?i.resolve(o._dbInfo.db):b(e).then((function(t){var n=f[e.name],r=n.forages;n.db=t;for(var s=0;s<r.length;s++)r[s]._dbInfo.db=t;return t}));r=e.storeName?l.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;p(e);var r=f[e.name],o=r.forages;t.close();for(var a=0;a<o.length;a++){var c=o[a];c._dbInfo.db=null,c._dbInfo.version=n}return new i((function(t,r){var o=s.open(e.name,n);o.onerror=function(e){o.result.close(),r(e)},o.onupgradeneeded=function(){o.result.deleteObjectStore(e.storeName)},o.onsuccess=function(){var e=o.result;e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<o.length;t++){var n=o[t];n._dbInfo.db=e,g(n._dbInfo)}})).catch((function(t){throw(_(e,t)||i.resolve()).catch((function(){})),t}))}})):l.then((function(t){p(e);var n=f[e.name],r=n.forages;t.close();for(var o=0;o<r.length;o++)r[o]._dbInfo.db=null;return new i((function(t,n){var r=s.deleteDatabase(e.name);r.onerror=r.onblocked=function(e){var t=r.result;t&&t.close(),n(e)},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<r.length;t++)g(r[t]._dbInfo)})).catch((function(t){throw(_(e,t)||i.resolve()).catch((function(){})),t}))}))}else r=i.reject("Invalid arguments");return a(r,t),r}},x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",N=/^~~local_forage_type~([^~]+)~/,T="__lfsc__:".length,O=T+"arbf".length,R=Object.prototype.toString;function D(e){var t,n,r,s,o,i=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var l=new ArrayBuffer(i),u=new Uint8Array(l);for(t=0;t<a;t+=4)n=x.indexOf(e[t]),r=x.indexOf(e[t+1]),s=x.indexOf(e[t+2]),o=x.indexOf(e[t+3]),u[c++]=n<<2|r>>4,u[c++]=(15&r)<<4|s>>2,u[c++]=(3&s)<<6|63&o;return l}function $(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=x[n[t]>>2],r+=x[(3&n[t])<<4|n[t+1]>>4],r+=x[(15&n[t+1])<<2|n[t+2]>>6],r+=x[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var P={serialize:function(e,t){var n="";if(e&&(n=R.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===R.call(e.buffer))){var r,s="__lfsc__:";e instanceof ArrayBuffer?(r=e,s+="arbf"):(r=e.buffer,"[object Int8Array]"===n?s+="si08":"[object Uint8Array]"===n?s+="ui08":"[object Uint8ClampedArray]"===n?s+="uic8":"[object Int16Array]"===n?s+="si16":"[object Uint16Array]"===n?s+="ur16":"[object Int32Array]"===n?s+="si32":"[object Uint32Array]"===n?s+="ui32":"[object Float32Array]"===n?s+="fl32":"[object Float64Array]"===n?s+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(s+$(r))}else if("[object Blob]"===n){var o=new FileReader;o.onload=function(){var n="~~local_forage_type~"+e.type+"~"+$(this.result);t("__lfsc__:blob"+n)},o.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if("__lfsc__:"!==e.substring(0,T))return JSON.parse(e);var t,n=e.substring(O),r=e.substring(T,O);if("blob"===r&&N.test(n)){var s=n.match(N);t=s[1],n=n.substring(s[0].length)}var i=D(n);switch(r){case"arbf":return i;case"blob":return o([i],{type:t});case"si08":return new Int8Array(i);case"ui08":return new Uint8Array(i);case"uic8":return new Uint8ClampedArray(i);case"si16":return new Int16Array(i);case"ur16":return new Uint16Array(i);case"si32":return new Int32Array(i);case"ui32":return new Uint32Array(i);case"fl32":return new Float32Array(i);case"fl64":return new Float64Array(i);default:throw new Error("Unkown type: "+r)}},stringToBuffer:D,bufferToString:$};function j(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function A(e,t,n,r,s,o){e.executeSql(n,r,s,(function(e,i){i.code===i.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?o(e,i):j(e,t,(function(){e.executeSql(n,r,s,o)}),o)}),o):o(e,i)}),o)}function L(e,t,n,r){var s=this;e=l(e);var o=new i((function(o,i){s.ready().then((function(){void 0===t&&(t=null);var a=t,c=s._dbInfo;c.serializer.serialize(t,(function(t,l){l?i(l):c.db.transaction((function(n){A(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){o(a)}),(function(e,t){i(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void o(L.apply(s,[e,a,n,r-1]));i(t)}}))}))})).catch(i)}));return a(o,n),o}function M(e){return new i((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var s=[],o=0;o<r.rows.length;o++)s.push(r.rows.item(o).name);t({db:e,storeNames:s})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}var B={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var s=new i((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(s){j(s,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=P,s},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,r=new i((function(t,r){n.ready().then((function(){var s=n._dbInfo;s.db.transaction((function(n){A(n,s,"SELECT * FROM "+s.storeName,[],(function(n,r){for(var o=r.rows,i=o.length,a=0;a<i;a++){var c=o.item(a),l=c.value;if(l&&(l=s.serializer.deserialize(l)),void 0!==(l=e(l,c.key,a+1)))return void t(l)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=new i((function(t,r){n.ready().then((function(){var s=n._dbInfo;s.db.transaction((function(n){A(n,s,"SELECT * FROM "+s.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=s.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,t),r},setItem:function(e,t,n){return L.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=l(e);var r=new i((function(t,r){n.ready().then((function(){var s=n._dbInfo;s.db.transaction((function(n){A(n,s,"DELETE FROM "+s.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,t),r},clear:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){A(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,e),n},length:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){A(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,e),n},key:function(e,t){var n=this,r=new i((function(t,r){n.ready().then((function(){var s=n._dbInfo;s.db.transaction((function(n){A(n,s,"SELECT key FROM "+s.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,t),r},keys:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){A(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],s=0;s<n.rows.length;s++)r.push(n.rows.item(s).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,e),n},dropInstance:function(e,t){t=u.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,s=this;return a(r=e.name?new i((function(t){var r;r=e.name===n.name?s._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(M(r))})).then((function(e){return new i((function(t,n){e.db.transaction((function(r){function s(e){return new i((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var o=[],a=0,c=e.storeNames.length;a<c;a++)o.push(s(e.storeNames[a]));i.all(o).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):i.reject("Invalid arguments"),t),r}};function U(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function F(){return!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}()||localStorage.length>0}var z={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=U(e,this._defaultConfig),F()?(this._dbInfo=t,t.serializer=P,i.resolve()):i.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,s=r.length,o=localStorage.length,i=1,a=0;a<o;a++){var c=localStorage.key(a);if(0===c.indexOf(r)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(s),i++)))return l}}}));return a(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return a(r,t),r},setItem:function(e,t,n){var r=this;e=l(e);var s=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new i((function(s,o){var i=r._dbInfo;i.serializer.serialize(t,(function(t,r){if(r)o(r);else try{localStorage.setItem(i.keyPrefix+e,t),s(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||o(e),o(e)}}))}))}));return a(s,n),s},removeItem:function(e,t){var n=this;e=l(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return a(r,t),r},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return a(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return a(t,e),t},key:function(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return a(r,t),r},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],s=0;s<n;s++){var o=localStorage.key(s);0===o.indexOf(e.keyPrefix)&&r.push(o.substring(e.keyPrefix.length))}return r}));return a(n,e),n},dropInstance:function(e,t){if(t=u.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,s=this;return a(r=e.name?new i((function(t){e.storeName?t(U(e,s._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):i.reject("Invalid arguments"),t),r}},J=function(e,t){for(var n,r,s=e.length,o=0;o<s;){if((n=e[o])===(r=t)||"number"==typeof n&&"number"==typeof r&&isNaN(n)&&isNaN(r))return!0;o++}return!1},W=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},q={},H={},G={INDEXEDDB:E,WEBSQL:B,LOCALSTORAGE:z},V=[G.INDEXEDDB._driver,G.WEBSQL._driver,G.LOCALSTORAGE._driver],K=["dropInstance"],Q=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(K),X={description:"",driver:V.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Y(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function Z(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(W(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var ee=new(function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),G)if(G.hasOwnProperty(n)){var r=G[n],s=r._driver;this[n]=s,q[s]||this.defineDriver(r)}this._defaultConfig=Z({},X),this._config=Z({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new i((function(t,n){try{var r=e._driver,s=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(s);for(var o=Q.concat("_initStorage"),c=0,l=o.length;c<l;c++){var u=o[c];if((!J(K,u)||e[u])&&"function"!=typeof e[u])return void n(s)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=i.reject(t);return a(n,arguments[arguments.length-1]),n}},n=0,r=K.length;n<r;n++){var s=K[n];e[s]||(e[s]=t(s))}}();var h=function(n){q[r]&&console.info("Redefining LocalForage driver: "+r),q[r]=e,H[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(h,n):h(!!e._support):h(!0)}catch(e){n(e)}}));return c(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=q[e]?i.resolve(q[e]):i.reject(new Error("Driver not found."));return c(r,t,n),r},e.prototype.getSerializer=function(e){var t=i.resolve(P);return c(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return c(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;W(e)||(e=[e]);var s=this._getSupportedDrivers(e);function o(){r._config.driver=r.driver()}function a(e){return r._extend(e),o(),r._ready=r._initStorage(r._config),r._ready}var l=null!==this._driverSet?this._driverSet.catch((function(){return i.resolve()})):i.resolve();return this._driverSet=l.then((function(){var e=s[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,o(),r._wrapLibraryMethodsWithReady(),r._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var s=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(s).then(a).catch(n)}o();var c=new Error("No available storage method found.");return r._driverSet=i.reject(c),r._driverSet}()}}(s)}))})).catch((function(){o();var e=new Error("No available storage method found.");return r._driverSet=i.reject(e),r._driverSet})),c(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!H[e]},e.prototype._extend=function(e){Z(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var s=e[n];this.supports(s)&&t.push(s)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=Q.length;e<t;e++)Y(this,Q[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=ee},{3:3}]},{},[4])(4)}));class ye{pixelStore$=D(null);_cellCount=0;constructor(e){this._cellCount=e}async init(){await this.loadPixels(),this.pixelStore$.subscribe(e=>{e&&(console.info({newValues:e}),be.setItem("pixels@v1",e))})}async loadPixels(){const e=await be.getItem("pixels@v1")||{};console.info({savedPixels:e}),this.pixelStore$.set(e)}addPixel(e){this._insertPixel(e)}_insertPixel(e){this.pixelStore$.update(t=>{for(let e=this._cellCount;e>=0;e--)t[e+1]=t[e];return t[0]=e,t})}}class we{lastMessageByUser={};canExecute(e){if(console.info({command:e}),e.badges&&"1"===e.badges.broadcaster)return!0;const t=this.lastMessageByUser[e.username];if(t){if((new Date).getTime()-t.getTime()<1e4)return!1}return this.lastMessageByUser[e.username]=new Date,!0}}function Ce(e,t,n){const r=e.slice();return r[17]=t[n],r}function Se(e){let t,n;return{c(){t=l("img"),t.src!==(n="https://static-cdn.jtvnw.net/emoticons/v1/"+e[1][e[17]].emote+"/4.0")&&h(t,"src",n),h(t,"class","svelte-1f9y8en")},m(e,n){a(e,t,n)},p(e,r){3&r&&t.src!==(n="https://static-cdn.jtvnw.net/emoticons/v1/"+e[1][e[17]].emote+"/4.0")&&h(t,"src",n)},d(e){e&&c(t)}}}function Ie(e){let t,n,r,s=e[1][e[17]]&&null!=e[1][e[17]].emote&&Se(e);return{c(){t=l("div"),s&&s.c(),n=u(),f(t,"background",e[1][e[17]]&&e[1][e[17]].color||"inherited"),h(t,"class",r="cell "+(e[1][e[17]]&&e[1][e[17]].color)+" svelte-1f9y8en")},m(e,r){a(e,t,r),s&&s.m(t,null),i(t,n)},p(e,o){e[1][e[17]]&&null!=e[1][e[17]].emote?s?s.p(e,o):(s=Se(e),s.c(),s.m(t,n)):s&&(s.d(1),s=null),3&o&&f(t,"background",e[1][e[17]]&&e[1][e[17]].color||"inherited"),3&o&&r!==(r="cell "+(e[1][e[17]]&&e[1][e[17]].color)+" svelte-1f9y8en")&&h(t,"class",r)},d(e){e&&c(t),s&&s.d()}}}function ke(t){let n,r,s,o=T(0,t[0],1),u=[];for(let e=0;e<o.length;e+=1)u[e]=Ie(Ce(t,o,e));return{c(){n=l("main"),r=l("div");for(let e=0;e<u.length;e+=1)u[e].c();h(r,"class",s="cell-holder "+t[2]+" svelte-1f9y8en"),f(r,"--cell-size",t[3]),f(r,"--cell-gap",t[4])},m(e,t){a(e,n,t),i(n,r);for(let e=0;e<u.length;e+=1)u[e].m(r,null)},p(e,[t]){if(3&t){let n;for(o=T(0,e[0],1),n=0;n<o.length;n+=1){const s=Ce(e,o,n);u[n]?u[n].p(s,t):(u[n]=Ie(s),u[n].c(),u[n].m(r,null))}for(;n<u.length;n+=1)u[n].d(1);u.length=o.length}},i:e,o:e,d(e){e&&c(n),function(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(u,e)}}}function Ee(e,t,n){const r=new O,s=r.getDirection(),o=r.getCellSize(),i=r.getCellGap(),a=new ve(r.getChannel()),c=new ye(r.getCells()),l=new we;a.commandReceived$.subscribe(e=>{if(!e)return;if(!l.canExecute(e))return;const{action:t,value:n}=e;"add"===t&&c.addPixel(n)});const u=c.pixelStore$;let h=r.getCells(),f={};u.subscribe(e=>{if(!e)return;console.info({value:e});const t={};Object.keys(e).forEach(n=>{const r=e[n];r&&(t[n]="string"==typeof r?{color:r}:r)}),n(1,f=t)});return async function(){await c.init()}(),[h,f,s,o,i]}return new class extends class{$destroy(){!function(e,t){const n=e.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}{constructor(e){super(),N(this,e,Ee,ke,o,{})}}({target:document.body,props:{name:"world"}})}();
//# sourceMappingURL=bundle.js.map
